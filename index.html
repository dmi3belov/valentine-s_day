<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ –¥–ª—è –ê–Ω—é—Ç—ã üíñ</title>
<style>
:root {
  --bg: #0b0b14;
  --neon-pink: #ff4fd8;
  --neon-blue: #4df0ff;
  --text: #ffffff;
  --card: rgba(255,255,255,0.06);
  --neon-green: #39ff14;
}

* { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }

body {
  margin: 0;
  background: radial-gradient(circle at top, #1a0033, var(--bg));
  color: var(--text);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  overflow: hidden;
}

.screens-container {
  width: 100%;
  height: 100vh;
  overflow-y: auto;
  position: relative;
  scroll-behavior: smooth;
}

.screen {
  display: none;
  width: 100%;
  max-width: 420px;
  padding: 24px;
  text-align: center;
  animation: fadeIn 0.6s ease;
  margin: 0 auto;
  min-height: 100vh;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.screen.active {
  display: flex;
}

#screen4 {
  justify-content: flex-start;
  padding-top: 10px;
  max-width: 420px;
}

h1, h2 { text-shadow: 0 0 10px var(--neon-pink); }
p { line-height: 1.5; opacity: 0.95; }

.card {
  background: var(--card);
  border-radius: 20px;
  padding: 24px;
  box-shadow:
    0 0 20px rgba(255,79,216,0.2),
    inset 0 0 20px rgba(255,255,255,0.03);
  max-height: calc(100vh - 40px);
  overflow-y: auto;
}

/* –ö–û–ù–¢–ï–ô–ù–ï–† –ò–ì–†–´ - –û–°–¢–ê–Å–¢–°–Ø 340px */
#screen4 .game-container {
  width: 340px !important;
  height: 340px !important;
  margin-left: auto;
  margin-right: auto;
}

button {
  margin-top: 20px;
  padding: 14px 22px;
  border-radius: 999px;
  border: none;
  background: linear-gradient(135deg, var(--neon-pink), var(--neon-blue));
  color: #000;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 15px var(--neon-pink);
  transition: transform 0.2s ease;
}

button:active { transform: scale(0.95); }
button:disabled { opacity: .4; filter: grayscale(1); box-shadow: none; cursor: not-allowed; }

ul { list-style: none; padding: 0; text-align: left; margin-top: 20px; }
li { margin-bottom: 10px; opacity: 0; transform: translateX(-20px); display: flex; align-items: center; }
li span { color: var(--text); opacity: 1; transition: color 0.3s ease; }
li span.neon { color: #ffffff; text-shadow: 0 0 4px var(--neon-pink), 0 0 10px #ffffff; font-size: 18px; }

/* ===== –ù–ï–û–ù–û–í–ê–Ø –ì–ê–õ–û–ß–ö–ê ===== */
#checklist li .check-glow {
  display: inline-block;
  width: 22px;
  height: 22px;
  margin-right: 15px;
  opacity: 0;
  transition: opacity 0.3s ease;
  filter: drop-shadow(0 0 2px var(--neon-green))
          drop-shadow(0 0 2px var(--neon-green))
          drop-shadow(0 0 5px var(--neon-green));
}

#checklist li .check {
  display: inline-block;
  width: 100%;
  height: 100%;
  background-color: var(--neon-green);
  -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z'/%3E%3C/svg%3E") no-repeat center / contain;
  mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z'/%3E%3C/svg%3E") no-repeat center / contain;
  font-size: 0;
}

#compatibility {
  opacity: 0;
  margin-top: 20px;
  text-align: center;
}
#compatibility .main {
  font-size: 18px;
  color: var(--neon-pink);
  text-shadow: 0 0 10px var(--neon-pink);
  font-weight: 750;
  animation: neonFlicker 5s infinite alternate;
}
#compatibility .sub {
  font-size: 14px;
  color: #ffffff;
  display: block;
  margin-top: 4px;
}

.progress {
  margin: 20px 0;
  height: 14px;
  border-radius: 999px;
  overflow: visible;
  background: rgba(255,255,255,0.1);
  position: relative;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue));
  box-shadow: 0 0 10px var(--neon-pink);
  border-radius: 999px;
  transition: width 0.2s linear;
}

#loadText { margin-top: 10px; font-weight: 600; letter-spacing: 1.5px; text-shadow: 0 0 8px var(--neon-blue); }
#errorText { margin-top: 6px; color: var(--neon-pink); font-size: 15px; opacity: 0; text-shadow: 0 0 10px var(--neon-pink); min-height:38px; transition: opacity 0.3s ease; }

.glitch { animation: glitch 0.2s linear infinite; }

@keyframes glitch {
  0%   { transform: translate(0); }
  20%  { transform: translate(-2px, 2px); }
  40%  { transform: translate(2px, -2px); }
  60%  { transform: translate(-2px, -1px); }
  80%  { transform: translate(1px, 2px); }
  100% { transform: translate(0); }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ª–∞–±–∏—Ä–∏–Ω—Ç–∞ */
.game-container {
  position: relative;
  margin: 6px auto 8px auto;
  border-radius: 0;
  overflow: hidden;
  background: #000000;
  border: 0px solid rgba(255,255,255,0.07);
  width: 340px !important;
  height: 340px !important;
  padding: 5px;
  box-sizing: border-box;
  flex-shrink: 0;
}

#mazeCanvas {
  display: block;
  width: 330px;
  height: 330px;
  background: #0a0a12;
  margin: 0 auto;
}

.player {
  position: absolute;
  width: 31px;
  height: 31px;
  top: 0;
  left: 0;
  border-radius: 50%;
  background: #4d8cff;
  box-shadow: 0 0 20px #4d8cff;
  transition: all 0.2s ease;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 17px;
  pointer-events: none;
}

.target {
  position: absolute;
  width: 28px;
  height: 28px;
  top: 0;
  left: 0;
  border-radius: 50%;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  z-index: 5;
  pointer-events: none;
  filter: drop-shadow(0 0 8px rgba(77, 240, 255, 0.9));
}

.collectible {
  position: absolute;
  width: 27px;
  height: 27px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--neon-pink), #ff6bff);
  box-shadow: 0 0 15px var(--neon-pink);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  z-index: 3;
  animation: float 3s ease-in-out infinite;
  pointer-events: none;
  transform: translateY(0);
}

@keyframes float {
  0% { transform: translateY(0); }
  25% { transform: translateY(2px); }
  75% { transform: translateY(-2px); }
  100% { transform: translateY(0); }
}

.maze-stats {
  display: flex;
  justify-content: space-around;
  padding: 8px 5px;
  background: rgba(255,255,255,0.05);
  border-radius: 10px;
}

.maze-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0 5px;
}

.maze-stat-value {
  font-size: 16px;
  font-weight: 700;
  text-shadow: 0 0 8px var(--neon-blue);
  line-height: 1;
}

.maze-stat-label {
  font-size: 10px;
  opacity: 0.8;
  margin-top: 2px;
}

.maze-controls-section {
  margin: 2px 0 4px 0;
  position: relative;
  height: 120px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.maze-controls-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  width: 100%;
  transition: opacity 0.5s ease;
}

.maze-completion-message {
  opacity: 0;
  transform: translateY(15px);
  transition: all 0.5s ease;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  font-size: 0.85em;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 120px;
}

.maze-completion-message.show {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.maze-completion-message h3 {
  font-size: 1.1em;
  margin-bottom: 6px;
  color: var(--neon-pink);
  text-shadow: 0 0 12px var(--neon-pink);
}

.dpad {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 3px;
  width: 110px;
  height: 110px;
}

.dpad-btn {
  background: rgba(255,255,255,0.1);
  border: 2px solid var(--neon-pink);
  border-radius: 6px;
  color: var(--neon-pink);
  font-size: 23px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
  user-select: none;
  box-shadow: 0 0 8px rgba(255, 79, 216, 0.7);
}

.dpad-btn:active {
  background: var(--neon-pink);
  color: #000;
  transform: scale(0.95);
}

.dpad-btn.up { grid-column: 2; grid-row: 1; }
.dpad-btn.left { grid-column: 1; grid-row: 2; }
.dpad-btn.center { grid-column: 2; grid-row: 2; opacity: 0; }
.dpad-btn.right { grid-column: 3; grid-row: 2; }
.dpad-btn.down { grid-column: 2; grid-row: 3; }

.trail {
  position: absolute;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #4d8cff;
  opacity: 0.6;
  pointer-events: none;
  z-index: 1;
  animation: fadeTrail 2s ease-out forwards;
  box-shadow: 0 0 8px #4d8cff;
}

.maze-action-buttons {
  display: flex;
  gap: 6px;
  justify-content: center;
  margin-top: 10px;
  flex-shrink: 0;
}

.maze-action-buttons button {
  min-width: 140px;
  max-width: 180px;
  font-size: 14px;
  padding: 12px 20px;
  margin-top: 0;
  background: linear-gradient(135deg, var(--neon-pink), var(--neon-blue));
  color: #000;
  font-weight: 700;
  border: none;
  border-radius: 999px;
  cursor: pointer;
  box-shadow: 0 0 15px var(--neon-pink);
  transition: all 0.2s ease;
  white-space: nowrap;
}

.maze-action-buttons button:active {
  transform: scale(0.95);
}

.maze-action-buttons button:disabled {
  opacity: 0.4;
  filter: grayscale(1);
  box-shadow: none;
  cursor: not-allowed;
}

.maze-action-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
  margin-top: 5px;
}

.mobile-hint {
  position: absolute;
  bottom: 15px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.7);
  color: var(--neon-blue);
  padding: 8px 16px;
  border-radius: 16px;
  border: 2px solid var(--neon-blue);
  font-size: 13px;
  text-align: center;
  z-index: 100;
  animation: fadeInOutMobile 3s ease-in-out forwards;
  max-width: 90%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  line-height: 1.4;
  white-space: normal;
  backdrop-filter: blur(2px);
  box-shadow: 0 0 12px rgba(77, 240, 255, 0.3);
  opacity: 0;
}

.mobile-hint .hint-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  white-space: nowrap;
}

.mobile-hint .hint-icon {
  animation: swipeHint 1.2s ease-in-out infinite;
  display: inline-block;
  transform-origin: center;
  filter: drop-shadow(0 0 3px var(--neon-blue));
  font-size: 16px;
}

@keyframes swipeHint {
  0% { transform: translateX(-3px); }
  50% { transform: translateX(5px); }
  100% { transform: translateX(-3px); }
}

@keyframes fadeInOutMobile {
  0% {
    opacity: 0;
    transform: translateX(-50%) translateY(8px);
  }
  15% {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  85% {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  100% {
    opacity: 0;
    transform: translateX(-50%) translateY(8px);
  }
}

@keyframes pulseTarget {
  0% { transform: scale(1); filter: drop-shadow(0 0 6px rgba(77, 240, 255, 0.8)); }
  100% { transform: scale(1.1); filter: drop-shadow(0 0 12px rgba(77, 240, 255, 1)); }
}

@keyframes fadeTrail {
  0% {
    opacity: 1;
    transform: scale(1);
    box-shadow: 0 0 8px #4d8cff;
  }
  30% {
    opacity: 1;
    transform: scale(0.9);
    box-shadow: 0 0 4px #4d8cff;
  }
  100% {
    opacity: 0;
    transform: scale(0.7);
    box-shadow: 0 0 0px #4d8cff;
  }
}

.footer { margin-top: 30px; font-size: 12px; opacity: 0.4; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ============ SCREEN 3 –°–¢–ò–õ–ò ============ */
#screen3 .attention {
  text-shadow: 0 0 10px var(--neon-pink);
  font-size: 24px;
  margin-bottom: 24px;
}

#screen3 .problem {
  color: var(--neon-pink);
  font-size: 22px;
  font-weight: 600;
  text-shadow: 0 0 8px var(--neon-pink), 0 0 15px var(--neon-pink);
  animation: neonBlink 1.5s infinite alternate;
  margin-bottom: 20px;
}

@keyframes neonBlink {
  0% { opacity: 0.8; text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
  50% { opacity: 1; text-shadow: 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink), 0 0 30px var(--neon-pink); }
  100% { opacity: 0.8; text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
}

#screen3 .think-text {
  font-size: 22px;
  line-height: 1.6;
  color: var(--neon-blue);
  text-shadow: 0 0 8px var(--neon-blue), 0 0 15px var(--neon-blue);
  margin: 25px 0 15px 0;
}

#screen3 .about-you {
  color: var(--neon-pink);
  text-shadow: 0 0 8px var(--neon-pink), 0 0 15px var(--neon-pink);
  animation: neonFlicker 5s infinite alternate;
  display: inline-block;
  font-weight: 700;
}

@keyframes neonFlicker {
  0%, 18%, 20%, 53%, 55%, 100% {
    opacity: 1;
    text-shadow:
      0 0 7px var(--neon-pink),
      0 0 10px var(--neon-pink),
      0 0 21px var(--neon-pink),
      0 0 42px var(--neon-pink),
      0 0 92px var(--neon-pink),
      0 0 102px var(--neon-pink);
  }
  19%, 54% {
    opacity: 0.6;
    text-shadow:
      0 0 4px var(--neon-pink),
      0 0 7px var(--neon-pink),
      0 0 14px var(--neon-pink),
      0 0 28px var(--neon-pink),
      0 0 60px var(--neon-pink),
      0 0 70px var(--neon-pink);
    color: #ff80ff;
  }
  2%, 8%, 14%, 30%, 36%, 42%, 58%, 64%, 70%, 86%, 92% {
    opacity: 0.9;
    text-shadow:
      0 0 6px var(--neon-pink),
      0 0 9px var(--neon-pink),
      0 0 18px var(--neon-pink),
      0 0 36px var(--neon-pink),
      0 0 76px var(--neon-pink),
      0 0 86px var(--neon-pink);
  }
  4%, 10%, 16%, 32%, 38%, 44%, 60%, 66%, 72%, 88%, 94% {
    opacity: 0.95;
    text-shadow:
      0 0 7px var(--neon-pink),
      0 0 10px var(--neon-pink),
      0 0 20px var(--neon-pink),
      0 0 40px var(--neon-pink),
      0 0 84px var(--neon-pink),
      0 0 94px var(--neon-pink);
  }
}

#screen3 .message {
  font-size: 16px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.7);
  opacity: 0.7;
  margin: 10px 0 30px 0;
}

#screen3 .card {
  min-height: 300px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* SCREEN 5 —Å—Ç–∏–ª–∏ */
#screen5 {
  position: relative;
}

#screen5 .card {
  min-height: 320px;
  position: relative;
  overflow: visible;
}

#screen5 .buttons-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 0;
  gap: 10px;
}

#screen5 .yes-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
  width: 100%;
}

#screen5 .no-btn {
  position: absolute;
  left: 0;
  top: 0;
  margin: 0;
  background: linear-gradient(135deg, var(--neon-pink), var(--neon-blue));
  transition: all 0.3s ease;
  z-index: 10;
}

/* SCREEN 6 —Å—Ç–∏–ª–∏ */
#screen6 .loved-text {
  font-size: 20px;
  color: var(--text);
  margin: 20px 0;
}

#screen6 .loved-text .flicker {
  color: var(--neon-pink);
  text-shadow: 0 0 8px var(--neon-pink), 0 0 15px var(--neon-pink);
  animation: neonFlicker 5s infinite alternate;
  animation-delay: 0.5s;
  opacity: 0;
  animation-fill-mode: forwards;
}

.flicker-start {
  opacity: 1;
  animation-delay: 0s;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞–∑–ª–µ—Ç–∞—é—â–∏—Ö—Å—è —Å–µ—Ä–¥–µ—á–µ–∫ */
.heart-particle {
  position: fixed;
  font-size: 24px;
  pointer-events: none;
  z-index: 1000;
  animation: heartExplode 3s ease-out forwards;
  will-change: transform, opacity;
}

@keyframes heartExplode {
  0% {
    transform: translate(0, 0) scale(1) rotate(0deg);
    opacity: 1;
  }
  20% {
    transform: translate(var(--tx), var(--ty)) scale(1.2) rotate(var(--rotate));
    opacity: 0.9;
  }
  60% {
    transform: translate(calc(var(--tx) * 1.8), calc(var(--ty) * 1.8)) scale(1) rotate(var(--rotate2));
    opacity: 0.7;
  }
  100% {
    transform: translate(calc(var(--tx) * 2.5), calc(var(--ty) * 2.5)) scale(0.5) rotate(var(--rotate3));
    opacity: 0;
  }
}

#screen6 .footer {
  font-size: 14px;
  margin-top: 25px;
  opacity: 0.7;
}

#screen6 #hugBtn {
  position: relative;
  overflow: hidden;
}

#screen6 #hugBtn:active {
  transform: scale(0.95);
}

.promise-block-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  width: fit-content;
  margin: 20px auto;
  font-size: 18px;
  line-height: 1.6;
  padding-right: 30px;
}

.promise-line-right {
  white-space: nowrap;
  text-align: right;
}

.hug-word {
  color: #ffa8ff;
  text-shadow: 0 0 4px #ffa8ff, 0 0 10px #ffa8ff;
  animation: colorChangeHug 4s infinite alternate;
}

.kiss-word {
  color: #a8fffa;
  text-shadow: 0 0 4px #a8fffa, 0 0 10px #a8fffa;
  animation: colorChangeKiss 4s infinite alternate;
}

.funny-word {
  color: #ffd8a8;
  text-shadow: 0 0 4px #ffd8a8, 0 0 10px #ffd8a8;
  animation: colorChangeFunny 4s infinite alternate;
}

@keyframes colorChangeHug {
  0% { color: #ffa8ff; text-shadow: 0 0 4px #ffa8ff, 0 0 10px #ffa8ff; }
  33% { color: #ffc8ff; text-shadow: 0 0 4px #ffc8ff, 0 0 10px #ffc8ff; }
  66% { color: #ffe8ff; text-shadow: 0 0 4px #ffe8ff, 0 0 10px #ffe8ff; }
  100% { color: #ffa8ff; text-shadow: 0 0 4px #ffa8ff, 0 0 10px #ffa8ff; }
}

@keyframes colorChangeKiss {
  0% { color: #a8fffa; text-shadow: 0 0 4px #a8fffa, 0 0 10px #a8fffa; }
  33% { color: #c8fffc; text-shadow: 0 0 4px #c8fffc, 0 0 10px #c8fffc; }
  66% { color: #e8fffe; text-shadow: 0 0 4px #e8fffe, 0 0 10px #e8fffe; }
  100% { color: #a8fffa; text-shadow: 0 0 4px #a8fffa, 0 0 10px #a8fffa; }
}

@keyframes colorChangeFunny {
  0% { color: #ffd8a8; text-shadow: 0 0 4px #ffd8a8, 0 0 10px #ffd8a8; }
  33% { color: #ffe0c8; text-shadow: 0 0 4px #ffe0c8, 0 0 10px #ffe0c8; }
  66% { color: #ffe8e0; text-shadow: 0 0 4px #ffe8e0, 0 0 10px #ffe8e0; }
  100% { color: #ffd8a8; text-shadow: 0 0 4px #ffd8a8, 0 0 10px #ffd8a8; }
}

.promise-word {
  color: #ffffff;
  text-shadow: 0 0 4px #ffffff, 0 0 10px #ffffff;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ 4 */
#screen4 h2 {
  margin-top: 0;
  margin-bottom: 8px;
}

#screen4 > .card > p {
  margin-top: 0;
  margin-bottom: 10px;
}

#screen4 .card::-webkit-scrollbar {
  width: 6px;
}

#screen4 .card::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

#screen4 .card::-webkit-scrollbar-thumb {
  background: var(--neon-pink);
  border-radius: 10px;
  box-shadow: 0 0 10px var(--neon-pink);
}

#screen4 .card::-webkit-scrollbar-thumb:hover {
  background: var(--neon-blue);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ 4-–º —ç–∫—Ä–∞–Ω–µ */
#screen4 .card {
  padding-top: 12px;
  min-height: auto;
  max-height: calc(100vh - 40px);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

@keyframes fadeInOut {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
  15% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  85% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
}

.screen:not(#screen4) .card {
  width: 100%;
  max-width: 380px;
  margin-left: auto;
  margin-right: auto;
}

/* –£–º–µ–Ω—å—à–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –∫–Ω–æ–ø–∫–∏ –Ω–∞ 3-–º —ç–∫—Ä–∞–Ω–µ */
#screen3 button {
  width: auto;
  min-width: 200px;
  max-width: 240px;
  padding: 12px 20px;
  font-size: 15px;
  margin-left: auto;
  margin-right: auto;
  white-space: nowrap;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
.no-btn-messages {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  pointer-events: none;
  width: 90%;
  max-width: 320px;
}

.no-btn-messages div {
  margin-bottom: 12px;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  will-change: transform, opacity, margin-bottom;
  transform: translateZ(0);
  backface-visibility: hidden;
  box-shadow: 0 0 20px var(--neon-pink);
}

/* –ù–µ–±–æ–ª—å—à–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —à–∏—Ä–∏–Ω—ã –Ω–∞ 1-–º —ç–∫—Ä–∞–Ω–µ */
#screen1 .progress {
  width: 95%;
  margin-left: auto;
  margin-right: auto;
}

#screen1 button {
  width: 80%;
  min-width: 220px;
  max-width: 300px;
  padding: 14px 0;
  margin-left: auto;
  margin-right: auto;
  display: block;
}

/* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –Ω–∞ 2-–º —ç–∫—Ä–∞–Ω–µ */
#screen2 ul { 
  padding-left: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#checklist li {
  width: 240px;
  margin-left: 0;
  margin-right: 0;
  padding-left: 20px;
  justify-content: flex-start;
}

</style>
</head>
<body>
<!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã -->
<audio id="neonOnSound" preload="auto">
  <source src="sounds/neon-on.mp3" type="audio/mpeg">
</audio>

<audio id="neonFlickerSound" preload="auto">
  <source src="sounds/neon-flicker.mp3" type="audio/mpeg">
</audio>

<audio id="neonHumSound" preload="auto" loop>
  <source src="sounds/neon-hum.mp3" type="audio/mpeg">
</audio>

<!-- –ù–û–í–´–ï –ê–£–î–ò–û –§–ê–ô–õ–´ -->
<audio id="whatIsLove" preload="auto" loop>
  <source src="sounds/8-Bit-Waht Is Love.mp3" type="audio/mpeg">
</audio>

<audio id="mazeFone" preload="auto" loop>
  <source src="sounds/maze_fone.mp3" type="audio/mpeg">
</audio>

<audio id="mazeCatch" preload="auto">
  <source src="sounds/maze_catch.mp3" type="audio/mpeg">
</audio>

<audio id="mazeFinal" preload="auto">
  <source src="sounds/maze_final.mp3" type="audio/mpeg">
</audio>

<div class="screens-container" id="screensContainer">
<!-- SCREEN 1 -->
<div class="screen active" id="screen1">
  <div class="card" style="min-height:250px; display:flex; flex-direction:column; justify-content:center;">
    <h2>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á—É–≤—Å—Ç–≤‚Ä¶</h2>
    <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É üíï</p>

    <div class="progress">
      <div class="progress-bar" id="loader"></div>
    </div>
    <p id="loadText">0%</p>
    <p id="errorText">
      –û–±–Ω–∞—Ä—É–∂–µ–Ω –∏–∑–±—ã—Ç–æ–∫ —á—É–≤—Å—Ç–≤<br>
      –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞...
    </p>

    <button id="continueBtn" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  </div>
</div>

<!-- SCREEN 2 -->
<div class="screen" id="screen2">
  <div class="card">
    <h2>–ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥—Ö–æ–¥–∏—à—å –ª–∏ —Ç—ã –º–Ω–µ üß†üíì</h2>
    <ul id="checklist">
      <li><span>–£–º–Ω–∞—è</span></li>
      <li><span>–ö—Ä–∞—Å–∏–≤–∞—è</span></li>
      <li><span>–ú–∏–ª–∞—è</span></li>
      <li><span>–°–º–µ—à–Ω–∞—è</span></li>
      <li><span>–í—Å—ë –µ—â—ë —á–∏—Ç–∞–µ—à—å —ç—Ç–æ</span></li>
    </ul>
    <p id="compatibility">
      <span class="main">100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</span><br>
      <span class="sub">(–î–∞, —è —Ç–æ–∂–µ —É–¥–∏–≤–ª—ë–Ω üòè)</span>
    </p>
    <button id="nextBtn" onclick="nextScreen(3)" disabled style="opacity: 0;">–ß—Ç–æ –¥–∞–ª—å—à–µ?</button>
  </div>
</div>

<!-- SCREEN 3 -->
<div class="screen" id="screen3">
  <div class="card">
    <div class="attention">–í–Ω–∏–º–∞–Ω–∏–µ!</div>
    <div class="problem">–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞</div>
    <div class="think-text">
      –Ø —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –¥—É–º–∞—é<br>
      <span class="about-you">–æ —Ç–µ–±–µ</span>
    </div>
    <p class="message">
      –ò—Å–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ —Å–æ–±–∏—Ä–∞—é—Å—å üòå
    </p>
    <button onclick="startMazeGame()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª—é–±–≤–∏</button>
  </div>
</div>

<!-- SCREEN 4 - –ò–ì–†–ê –í –õ–ê–ë–ò–†–ò–ù–¢ -->
<div class="screen" id="screen4">
  <div class="card">
    <h2>–õ–∞–±–∏—Ä–∏–Ω—Ç —á—É–≤—Å—Ç–≤ üåÄ</h2>
    <p>–ü—Ä–æ–≤–µ–¥–∏ —Å–µ—Ä–¥—Ü–µ —á–µ—Ä–µ–∑ –ª–∞–±–∏—Ä–∏–Ω—Ç –∫ —Ü–µ–ª–∏, —Å–æ–±–∏—Ä–∞—è —á–∞—Å—Ç–∏—á–∫–∏ –ª—é–±–≤–∏ –ø–æ –ø—É—Ç–∏</p>

    <div class="maze-stats">
      <div class="maze-stat">
        <div class="maze-stat-value" id="steps">0</div>
        <div class="maze-stat-label">–®–∞–≥–∏</div>
      </div>
      <div class="maze-stat">
        <div class="maze-stat-value" id="collected">0/5</div>
        <div class="maze-stat-label">–°–æ–±—Ä–∞–Ω–æ</div>
      </div>
      <div class="maze-stat">
        <div class="maze-stat-value" id="time">0</div>
        <div class="maze-stat-label">–°–µ–∫—É–Ω–¥—ã</div>
      </div>
    </div>

    <div class="game-container" id="gameContainer">
      <canvas id="mazeCanvas"></canvas>
      <div id="gameElements"></div>
    </div>

    <div class="maze-controls-section">
      <div id="mazeControlsContainer" class="maze-controls-container">
        <div class="dpad">
          <div class="dpad-btn up" onclick="movePlayer(0, -1)">‚¨ÜÔ∏è</div>
          <div class="dpad-btn left" onclick="movePlayer(-1, 0)">‚¨ÖÔ∏è</div>
          <div class="dpad-btn center"></div>
          <div class="dpad-btn right" onclick="movePlayer(1, 0)">‚û°Ô∏è</div>
          <div class="dpad-btn down" onclick="movePlayer(0, 1)">‚¨áÔ∏è</div>
        </div>
      </div>

      <div class="maze-completion-message" id="mazeCompletionMessage">
        <h3>–õ–∞–±–∏—Ä–∏–Ω—Ç –ø—Ä–æ–π–¥–µ–Ω! üèÜ</h3>
        <p>–¢—ã –Ω–∞—à–ª–∞ –ø—É—Ç—å –∫ –º–æ–µ–º—É —Å–µ—Ä–¥—Ü—É —á–µ—Ä–µ–∑ –≤—Å–µ –ø—Ä–µ–≥—Ä–∞–¥—ã! üíñ</p>
      </div>
    </div>

    <div class="maze-action-buttons">
      <button id="restartBtn" onclick="restartMazeGame()">
        –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ üîÑ
      </button>
      <button id="nextMazeBtn" onclick="nextScreen(5)" disabled>
        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚ú®
      </button>
    </div>
  </div>
</div>

<!-- SCREEN 5 -->
<div class="screen" id="screen5">
  <div class="card">
    <h2>–í–æ–ø—Ä–æ—Å –∂–∏–∑–Ω–∏ –∏ —Å–µ—Ä–¥—Ü–∞ üíò</h2>
    <p>–¢—ã —Å–æ–≥–ª–∞—Å–Ω–∞ –±—ã—Ç—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?</p>

    <div class="buttons-container">
      <div class="yes-buttons">
        <button onclick="nextScreen(6)">–î–∞ üíñ</button>
        <button onclick="nextScreen(6)">–ö–æ–Ω–µ—á–Ω–æ –¥–∞ üíò</button>
      </div>

      <div class="no-btn-area" style="position: relative; width: 100%; height: 200px; margin-top: 0; border-radius: 15px; overflow: visible;">
        <button class="no-btn" id="noBtn" style="position: absolute; left: 50%; top: 10px; transform: translateX(-50%); margin: 0; transition: all 0.3s ease; z-index: 10;">
          –ù–µ—Ç üôà
        </button>
      </div>
    </div>
  </div>
</div>

<!-- SCREEN 6 -->
<div class="screen" id="screen6">
  <div class="card">
    <h1>–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! üíï</h1>
    <div class="loved-text">
      –¢—ã –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –º–æ–π —Å–∞–º—ã–π <span class="flicker">–ª—é–±–∏–º—ã–π</span> —á–µ–ª–æ–≤–µ–∫ üíñ
    </div>

    <div class="promise-block-right">
      <div class="promise-line-right">
        <span class="promise-word">–û–±–µ—â–∞—é</span>
        <span class="hug-word">–æ–±–Ω–∏–º–∞—Ç—å</span>
        <span>ü§ó</span>
      </div>

      <div class="promise-line-right">
        <span class="kiss-word">—Ü–µ–ª–æ–≤–∞—Ç—å</span>
        <span>üòò</span>
      </div>

      <div class="promise-line-right">
        <span class="funny-word">—Å–º–µ—à–∏—Ç—å</span>
        <span>ü§™</span>
      </div>
    </div>

    <button id="hugBtn">–û–±–Ω—è—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</button>
    <div class="footer">
      –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –∏ –º—ã—Å–ª—è–º–∏ –æ —Ç–µ–±–µ üíï
    </div>
  </div>
</div>

<script>
// ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–í–£–ö–ê–ú–ò ====================
let soundInitialized = false;
let currentMazeFone = null;
let currentWhatIsLove = null;

function initAllSounds() {
  if (soundInitialized) return;

  const sounds = ['neonOnSound', 'neonFlickerSound', 'neonHumSound', 'whatIsLove', 'mazeFone', 'mazeCatch', 'mazeFinal'];

  sounds.forEach(id => {
    const audio = document.getElementById(id);
    if (audio) {
      audio.volume = 0.3;
      audio.load();
    }
  });

  soundInitialized = true;
}

function stopAllMazeSounds() {
  if (currentMazeFone) {
    currentMazeFone.pause();
    currentMazeFone.currentTime = 0;
    currentMazeFone = null;
  }

  const whatIsLove = document.getElementById('whatIsLove');
  if (whatIsLove) {
    whatIsLove.pause();
    whatIsLove.currentTime = 0;
  }
}

function stopAllNeonSounds() {
  const neonOn = document.getElementById('neonOnSound');
  const neonFlicker = document.getElementById('neonFlickerSound');

  if (neonOn) {
    neonOn.pause();
    neonOn.currentTime = 0;
  }
  if (neonFlicker) {
    neonFlicker.pause();
    neonFlicker.currentTime = 0;
  }

  if (flickerInterval) {
    clearInterval(flickerInterval);
    flickerInterval = null;
  }
}

function playMazeFone() {
  stopAllMazeSounds();
  const mazeFone = document.getElementById('mazeFone');
  if (mazeFone) {
    mazeFone.volume = 0.2;
    mazeFone.loop = true;
    mazeFone.play().catch(e => console.log("Maze fone play failed:", e));
    currentMazeFone = mazeFone;
  }
}

function playMazeCatch() {
  const mazeCatch = document.getElementById('mazeCatch');
  if (mazeCatch) {
    mazeCatch.currentTime = 0;
    mazeCatch.volume = 0.4;
    mazeCatch.play().catch(e => console.log("Maze catch play failed:", e));
  }
}

function playMazeFinal() {
  const mazeFinal = document.getElementById('mazeFinal');
  if (mazeFinal) {
    mazeFinal.currentTime = 0;
    mazeFinal.volume = 0.5;
    mazeFinal.play().catch(e => console.log("Maze final play failed:", e));
  }
}

function playWhatIsLove() {
  stopAllNeonSounds();
  stopNeonHum();
  stopAllMazeSounds();

  const whatIsLove = document.getElementById('whatIsLove');
  if (whatIsLove) {
    whatIsLove.volume = 0.3;
    whatIsLove.loop = true;
    whatIsLove.play().catch(e => console.log("What is love play failed:", e));
    currentWhatIsLove = whatIsLove;
  }
}

// ==================== –ó–í–£–ö–ò –ù–ï–û–ù–û–í–û–ô –ê–ù–ò–ú–ê–¶–ò–ò ====================
let neonHumPlaying = false;
let flickerInterval;

function playNeonOnSound() {
  const sound = document.getElementById('neonOnSound');
  if (sound) {
    sound.currentTime = 0;
    sound.volume = 0.4;
    sound.play().catch(e => console.log("Audio play failed:", e));
    setTimeout(startNeonHum, 200);
  }
}

function playNeonFlickerSound() {
  const sound = document.getElementById('neonFlickerSound');
  if (sound) {
    sound.currentTime = 0;
    sound.volume = 0.2;
    sound.play().catch(e => console.log("Flicker sound play failed:", e));
  }
}

function startNeonHum() {
  if (neonHumPlaying) return;

  const hum = document.getElementById('neonHumSound');
  if (hum) {
    hum.volume = 0.1;
    hum.loop = true;
    hum.play().catch(e => console.log("Hum sound play failed:", e));
    neonHumPlaying = true;
  }
}

function stopNeonHum() {
  const hum = document.getElementById('neonHumSound');
  if (hum) {
    hum.pause();
    hum.currentTime = 0;
    neonHumPlaying = false;
  }
}

function startNeonAnimation() {
  const flickerElement = document.querySelector('.flicker');
  if (!flickerElement) return;

  playNeonOnSound();

  setTimeout(() => {
    flickerElement.classList.add('flicker-start');
    startFlickerSoundInterval();
  }, 300);
}

function startFlickerSoundInterval() {
  if (flickerInterval) clearInterval(flickerInterval);

  flickerInterval = setInterval(() => {
    const randomDelay = Math.random() * 500;
    setTimeout(playNeonFlickerSound, randomDelay);
  }, 2000);
}

function stopNeonAnimation() {
  const flickerElement = document.querySelector('.flicker');
  if (flickerElement) {
    flickerElement.classList.remove('flicker-start');
  }

  if (flickerInterval) {
    clearInterval(flickerInterval);
    flickerInterval = null;
  }

  stopNeonHum();
}

// ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –õ–ê–ë–ò–†–ò–ù–¢–ê ====================
const MAZE_COLS = 10, MAZE_ROWS = 10;
let gameActive = false, player = { x: 1, y: 1 }, target = { x: 8, y: 8 };
let collectibles = [], steps = 0, collected = 0, timeElapsed = 0;
const REQUIRED_COLLECTIBLES = 5;
let maze = [], cellSize = 0, canvas, ctx, gameInterval, hasWon = false;

// ==================== –§–£–ù–ö–¶–ò–ò –õ–ê–ë–ò–†–ò–ù–¢–ê ====================
function initMazeGame() {
  canvas = document.getElementById('mazeCanvas');
  ctx = canvas.getContext('2d');

  canvas.width = 330;
  canvas.height = 330;
  cellSize = canvas.width / MAZE_COLS;

  const container = document.getElementById('gameContainer');
  container.style.width = '340px';
  container.style.height = '340px';
  container.style.padding = '5px';
  container.style.borderRadius = '0';

  setupTouchControls();

  gameActive = false;
  steps = 0;
  collected = 0;
  timeElapsed = 0;
  hasWon = false;

  document.getElementById('steps').textContent = '0';
  document.getElementById('collected').textContent = '0/' + REQUIRED_COLLECTIBLES;
  document.getElementById('time').textContent = '0';

  document.getElementById('mazeControlsContainer').style.opacity = '1';
  document.getElementById('mazeCompletionMessage').classList.remove('show');
  document.getElementById('nextMazeBtn').disabled = true;

  generateMaze();
  drawMaze();
  drawGameElements();

  if (gameInterval) clearInterval(gameInterval);
  gameInterval = setInterval(updateTimer, 1000);
  gameActive = true;

  if (window.innerWidth <= 768) {
    showMobileHint();
  }

  playMazeFone();
}

function restartMazeGame() {
  initMazeGame();
}

function generateMaze() {
  const rows = MAZE_ROWS, cols = MAZE_COLS;
  maze = Array(rows).fill().map(() => Array(cols).fill().map(() => ({
    top: true, right: true, bottom: true, left: true, visited: false
  })));

  const stack = [];
  let current = { x: 0, y: 0 };
  maze[0][0].visited = true;

  while (true) {
    const neighbors = [];

    if (current.y > 0 && !maze[current.y - 1][current.x].visited) {
      neighbors.push({ x: current.x, y: current.y - 1, dir: 'top' });
    }
    if (current.x < cols - 1 && !maze[current.y][current.x + 1].visited) {
      neighbors.push({ x: current.x + 1, y: current.y, dir: 'right' });
    }
    if (current.y < rows - 1 && !maze[current.y + 1][current.x].visited) {
      neighbors.push({ x: current.x, y: current.y + 1, dir: 'bottom' });
    }
    if (current.x > 0 && !maze[current.y][current.x - 1].visited) {
      neighbors.push({ x: current.x - 1, y: current.y, dir: 'left' });
    }

    if (neighbors.length > 0) {
      const next = neighbors[Math.floor(Math.random() * neighbors.length)];
      stack.push(current);

      if (next.dir === 'top') {
        maze[current.y][current.x].top = false;
        maze[next.y][next.x].bottom = false;
      } else if (next.dir === 'right') {
        maze[current.y][current.x].right = false;
        maze[next.y][next.x].left = false;
      } else if (next.dir === 'bottom') {
        maze[current.y][current.x].bottom = false;
        maze[next.y][next.x].top = false;
      } else if (next.dir === 'left') {
        maze[current.y][current.x].left = false;
        maze[next.y][next.x].right = false;
      }

      maze[next.y][next.x].visited = true;
      current = { x: next.x, y: next.y };
    } else if (stack.length > 0) {
      current = stack.pop();
    } else {
      break;
    }
  }

  player = { x: 1, y: 1 };
  target = { x: cols - 2, y: rows - 2 };

  collectibles = [];
  const totalCollectibles = 12;

  for (let i = 0; i < totalCollectibles; i++) {
    let x, y;
    do {
      x = Math.floor(Math.random() * cols);
      y = Math.floor(Math.random() * rows);
    } while ((x === player.x && y === player.y) ||
             (x === target.x && y === target.y) ||
             collectibles.some(c => c.x === x && c.y === y));

    collectibles.push({
      x, y,
      collected: false,
      emoji: ['üíñ', 'üíï', 'üíó', 'üíì', 'üíû', 'üíù', 'üíò', 'üíü'][i % 8],
      id: `collectible_${i}`
    });
  }
}

function drawMaze() {
  const rows = MAZE_ROWS, cols = MAZE_COLS;

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#0a0a12';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
  ctx.lineWidth = 2;

  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      const cell = maze[y][x];
      const px = x * cellSize;
      const py = y * cellSize;

      if (cell.top) {
        ctx.beginPath();
        ctx.moveTo(px, py);
        ctx.lineTo(px + cellSize, py);
        ctx.stroke();
      }
      if (cell.right) {
        ctx.beginPath();
        ctx.moveTo(px + cellSize, py);
        ctx.lineTo(px + cellSize, py + cellSize);
        ctx.stroke();
      }
      if (cell.bottom) {
        ctx.beginPath();
        ctx.moveTo(px, py + cellSize);
        ctx.lineTo(px + cellSize, py + cellSize);
        ctx.stroke();
      }
      if (cell.left) {
        ctx.beginPath();
        ctx.moveTo(px, py);
        ctx.lineTo(px, py + cellSize);
        ctx.stroke();
      }
    }
  }

  ctx.fillStyle = 'rgba(255, 79, 216, 0.03)';
  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      ctx.fillRect(x * cellSize + 1, y * cellSize + 1, cellSize - 2, cellSize - 2);
    }
  }
}

function createElement(tag, className, text, left, top) {
  const el = document.createElement(tag);
  el.className = className;
  el.textContent = text;
  el.style.left = left + 'px';
  el.style.top = top + 'px';
  return el;
}

function drawGameElements() {
  const gameElements = document.getElementById('gameElements');
  gameElements.innerHTML = '';
  const offset = 5, half = 16.5;

  const playerEl = createElement('div', 'player', 'üíñ',
    offset + player.x * cellSize + half - 15.5,
    offset + player.y * cellSize + half - 15.5);
  gameElements.appendChild(playerEl);

  const targetEl = createElement('div', 'target', 'üéØ',
    offset + target.x * cellSize + half - 14,
    offset + target.y * cellSize + half - 14);
  gameElements.appendChild(targetEl);

  collectibles.forEach((item, i) => {
    if (!item.collected) {
      const el = createElement('div', 'collectible', item.emoji,
        offset + item.x * cellSize + half - 13.5,
        offset + item.y * cellSize + half - 13.5);
      el.setAttribute('data-id', item.id);
      el.style.animationDelay = (i * 0.2) + 's';
      gameElements.appendChild(el);
    }
  });
}

function setupTouchControls() {
  if (!canvas) canvas = document.getElementById('mazeCanvas');
  if (!canvas) return;

  ['touchstart', 'touchend'].forEach(event => {
    canvas.removeEventListener(event, canvas[`_${event}`]);
  });

  let touchStartX = 0, touchStartY = 0;

  canvas._touchstart = (e) => {
    if (!gameActive) return;
    e.preventDefault();
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
  };

  canvas._touchend = (e) => {
    if (!gameActive) return;
    e.preventDefault();

    const deltaX = e.changedTouches[0].clientX - touchStartX;
    const deltaY = e.changedTouches[0].clientY - touchStartY;

    if (Math.abs(deltaX) > Math.abs(deltaY)) {
      if (deltaX > 25) movePlayer(1, 0);
      else if (deltaX < -25) movePlayer(-1, 0);
    } else {
      if (deltaY > 25) movePlayer(0, 1);
      else if (deltaY < -25) movePlayer(0, -1);
    }
  };

  canvas.addEventListener('touchstart', canvas._touchstart, { passive: false });
  canvas.addEventListener('touchend', canvas._touchend, { passive: false });
}

function canMove(dx, dy) {
  const cell = maze[player.y][player.x];
  if (dx === 1) return !cell.right;
  if (dx === -1) return !cell.left;
  if (dy === 1) return !cell.bottom;
  if (dy === -1) return !cell.top;
  return false;
}

function checkCollectibles() {
  let collectedThisMove = false;

  collectibles.forEach(item => {
    if (!item.collected && item.x === player.x && item.y === player.y) {
      item.collected = true;
      collected++;
      collectedThisMove = true;
      document.getElementById('collected').textContent = collected + '/' + REQUIRED_COLLECTIBLES;
      if (navigator.vibrate) navigator.vibrate([40, 40, 80]);

      const el = document.querySelector(`[data-id="${item.id}"]`);
      if (el) el.remove();
    }
  });

  if (collectedThisMove) playMazeCatch();
}

function movePlayer(dx, dy) {
  if (!gameActive) return;

  const newX = player.x + dx;
  const newY = player.y + dy;

  if (newX < 0 || newX >= MAZE_COLS || newY < 0 || newY >= MAZE_ROWS) {
    if (navigator.vibrate) navigator.vibrate(80);
    return;
  }

  if (!canMove(dx, dy)) {
    if (navigator.vibrate) navigator.vibrate(80);
    return;
  }

  createTrail(player.x, player.y);

  player.x = newX;
  player.y = newY;
  steps++;
  document.getElementById('steps').textContent = steps;

  if (navigator.vibrate) navigator.vibrate(20);

  checkCollectibles();
  updatePlayerPosition();

  if (player.x === target.x && player.y === target.y) {
    if (collected >= REQUIRED_COLLECTIBLES) {
      completeMazeGame();
    } else {
      showNeedMoreCollectibles();
    }
  }
}

function updatePlayerPosition() {
  const playerElement = document.querySelector('.player');
  if (playerElement) {
    const offset = 5;
    playerElement.style.left = (offset + player.x * cellSize + 16.5 - 15.5) + 'px';
    playerElement.style.top = (offset + player.y * cellSize + 16.5 - 15.5) + 'px';
  }
}

function showNeedMoreCollectibles() {
  if (navigator.vibrate) navigator.vibrate([100, 50, 100]);

  const message = document.createElement('div');
  message.style.cssText = `
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.85);
    color: var(--neon-pink);
    padding: 12px 20px;
    border-radius: 15px;
    border: 2px solid var(--neon-pink);
    font-weight: bold;
    text-align: center;
    z-index: 1000;
    animation: fadeInOut 1.5s ease forwards;
    pointer-events: none;
    box-shadow: 0 0 20px rgba(255, 79, 216, 0.5);
  `;

  const needed = REQUIRED_COLLECTIBLES - collected;
  message.innerHTML = `–ù—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –µ—â–µ ${needed} —á–∞—Å—Ç–∏—á–µ–∫ –ª—é–±–≤–∏! üíñ`;

  document.getElementById('gameContainer').appendChild(message);

  setTimeout(() => {
    if (message.parentNode) message.remove();
  }, 1500);
}

function createTrail(x, y) {
  const trail = document.createElement('div');
  trail.className = 'trail';
  const offset = 5;
  trail.style.left = (offset + x * cellSize + 16.5 - 3) + 'px';
  trail.style.top = (offset + y * cellSize + 16.5 - 3) + 'px';

  document.getElementById('gameElements').appendChild(trail);

  setTimeout(() => {
    if (trail.parentNode) trail.remove();
  }, 1500);
}

function updateTimer() {
  if (!gameActive) return;
  timeElapsed++;
  document.getElementById('time').textContent = timeElapsed;
}

function startMazeGame() {
  nextScreen(4);
  setTimeout(() => initMazeGame(), 50);
}

function showMobileHint() {
  const hint = document.createElement('div');
  hint.className = 'mobile-hint';
  hint.innerHTML = `
    <div class="hint-row">
      <span class="hint-icon">üëÜ</span>
      <span>–°–≤–∞–π–ø–∞–π –ø–æ —ç–∫—Ä–∞–Ω—É</span>
    </div>
    <div>–¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è</div>
  `;
  document.querySelector('.game-container').appendChild(hint);
  setTimeout(() => hint.remove(), 3000);
}

function completeMazeGame() {
  gameActive = false;
  hasWon = true;
  clearInterval(gameInterval);

  stopAllMazeSounds();
  playMazeFinal();

  if (navigator.vibrate) navigator.vibrate([80, 40, 80, 40, 150]);

  const mazeControlsContainer = document.getElementById('mazeControlsContainer');
  const mazeCompletionMessage = document.getElementById('mazeCompletionMessage');
  const nextMazeBtn = document.getElementById('nextMazeBtn');

  const totalCollectibles = collectibles.length;
  const isPerfect = collected >= totalCollectibles;

  mazeCompletionMessage.innerHTML = isPerfect ? `
    <h3 style="color: var(--neon-pink); text-shadow: 0 0 12px var(--neon-pink);">
      üíñ –ò–î–ï–ê–õ–¨–ù–û! üíñ
    </h3>
    <p style="color: var(--neon-blue); text-shadow: 0 0 8px var(--neon-blue); font-size: 1.1em;">
      –¢—ã —Å–æ–±—Ä–∞–ª–∞ –í–°–ï —á–∞—Å—Ç–∏—á–∫–∏ –ª—é–±–≤–∏!
    </p>
  ` : `
    <h3 style="color: var(--neon-pink); text-shadow: 0 0 12px var(--neon-pink);">
      –õ–∞–±–∏—Ä–∏–Ω—Ç –ø—Ä–æ–π–¥–µ–Ω! üèÜ
    </h3>
    <p>–¢—ã —Å–æ–±—Ä–∞–ª–∞ ${collected} –∏–∑ ${REQUIRED_COLLECTIBLES} —á–∞—Å—Ç–∏—á–µ–∫ –ª—é–±–≤–∏! üíñ</p>
  `;

  mazeControlsContainer.style.opacity = '0';
  setTimeout(() => mazeCompletionMessage.classList.add('show'), 300);

  nextMazeBtn.disabled = false;
  createFireworks();
}

function createFireworks() {
  const container = document.querySelector('.game-container');
  const offset = 5;

  for (let i = 0; i < 15; i++) {
    setTimeout(() => {
      const firework = document.createElement('div');
      const xPos = offset + Math.random() * (canvas.width - 30) + 15;
      const yPos = offset + Math.random() * (canvas.height - 30) + 15;

      firework.style.cssText = `
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: ${Math.random() > 0.5 ? 'var(--neon-pink)' : 'var(--neon-blue)'};
        left: ${xPos}px;
        top: ${yPos}px;
        animation: explode 0.8s ease-out forwards;
        pointer-events: none;
        z-index: 1000;
      `;

      container.appendChild(firework);
      setTimeout(() => firework.remove(), 800);
    }, i * 80);
  }
}

// ==================== –û–°–ù–û–í–ù–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø ====================
let current = 4;

function nextScreen(n){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  current = n;
  document.getElementById(`screen${n}`).classList.add('active');

  const neonOn = document.getElementById('neonOnSound');
  if (neonOn) {
    neonOn.pause();
    neonOn.currentTime = 0;
  }

  const neonFlicker = document.getElementById('neonFlickerSound');
  if (neonFlicker) {
    neonFlicker.pause();
    neonFlicker.currentTime = 0;
  }

  if (flickerInterval) {
    clearInterval(flickerInterval);
    flickerInterval = null;
  }

  if (n === 3) {
    if (!neonHumPlaying) {
      startNeonHum();
    }
  } else {
    const neonHum = document.getElementById('neonHumSound');
    if (neonHum) {
      neonHum.pause();
      neonHum.currentTime = 0;
      neonHumPlaying = false;
    }
  }

  if (n === 2) {
    showChecklist();
  }

  if (n === 6) {
    stopAllMazeSounds();
    playWhatIsLove();
  }
}

function setupScrollBehavior() {
  const screensContainer = document.getElementById('screensContainer');

  const originalNextScreen = window.nextScreen;

  window.nextScreen = function(n) {
    originalNextScreen(n);

    setTimeout(() => {
      if (current === 4) {
        screensContainer.style.overflowY = 'auto';
        screensContainer.scrollTo({
          top: document.getElementById('screen4').offsetTop,
          behavior: 'instant'
        });
      } else {
        screensContainer.style.overflowY = 'hidden';
        screensContainer.scrollTo({
          top: document.getElementById(`screen${current}`).offsetTop,
          behavior: 'instant'
        });
      }
    }, 10);
  };

  setTimeout(() => {
    screensContainer.style.overflowY = 'hidden';
  }, 100);
}

document.addEventListener('DOMContentLoaded', function() {
  setupScrollBehavior();
  initAllSounds();
});

/* ===== LOADER ===== */
const loader = document.getElementById('loader');
const loadText = document.getElementById('loadText');
const errorText = document.getElementById('errorText');
const continueBtn = document.getElementById('continueBtn');

let progress = 0;
let attempt = 1;
let pausePoints = [];

function generatePausePoints(){
  pausePoints = [];
  while(pausePoints.length<3){
    let point = Math.floor(Math.random()*80)+10;
    if(!pausePoints.includes(point)) pausePoints.push(point);
  }
  pausePoints.sort((a,b)=>a-b);
}
generatePausePoints();

function animateProgress(to, callback){
  const step = ()=>{
    if(progress < to){
      progress += 0.5;
      if(progress > to) progress = to;
      loader.style.width = progress+'%';
      let percent = Math.floor(progress);
      loadText.innerText = percent + '%';

      if(progress > 100){
        loader.style.background = 'linear-gradient(90deg, #ff1a75, #ff4fd8)';
        loader.style.boxShadow = '0 0 15px #ff1a75,0 0 30px #ff4fd8';
        loadText.style.color = '#ff1a75';
        loadText.style.textShadow = '0 0 8px #ff1a75';
      } else {
        loader.style.background = 'linear-gradient(90deg, var(--neon-pink), var(--neon-blue))';
        loader.style.boxShadow = '0 0 10px var(--neon-pink)';
        loadText.style.color = 'var(--text)';
        loadText.style.textShadow = '0 0 8px var(--neon-blue)';
      }

      if(pausePoints.includes(Math.floor(progress)) && progress<=100){
        setTimeout(()=>requestAnimationFrame(step),400);
      } else {
        requestAnimationFrame(step);
      }
    } else if(callback) callback();
  };
  requestAnimationFrame(step);
}

function animateRollback(to, callback){
  const step = ()=>{
    if(progress > to){
      progress -= 1;
      if(progress < to) progress = to;
      loader.style.width = progress+'%';
      loadText.innerText = Math.floor(progress)+'%';
      if(progress <=100){
        loader.style.background = 'linear-gradient(90deg, var(--neon-pink), var(--neon-blue))';
        loader.style.boxShadow = '0 0 10px var(--neon-pink)';
        loadText.style.color = 'var(--text)';
        loadText.style.textShadow = '0 0 8px var(--neon-blue)';
      }
      requestAnimationFrame(step);
    } else if(callback) callback();
  };
  requestAnimationFrame(step);
}

function pauseOverload(){
  errorText.style.opacity=1;
  setTimeout(()=>{
    animateRollback(0, ()=>{
      errorText.style.opacity=0;
      attempt=2;
      setTimeout(startLoading, 500);
    });
  },1500);
}

function startLoading(){
  if(attempt===1) progress=0;
  const interval = setInterval(()=>{
    let nextStep = progress + (Math.random()*6+4);
    if(attempt===1 && progress < 98){
      if(nextStep > 98) nextStep = 98;
      animateProgress(nextStep);
      return;
    }
    if(attempt===1 && progress >= 98){
      clearInterval(interval);
      const overload = Math.floor(Math.random()*9+101);
      setTimeout(()=>{ animateProgress(overload, pauseOverload); }, 500);
      return;
    }
    if(attempt===2 && nextStep >= 100){
      nextStep = 100;
      clearInterval(interval);
      animateProgress(nextStep, ()=>{continueBtn.disabled=false});
      return;
    }
    animateProgress(nextStep);
  }, Math.random()*250+150);
}

setTimeout(startLoading, Math.random()*500+500);
continueBtn.addEventListener('click', ()=> nextScreen(2));

/* ===== SCREEN 2 CHECKLIST ===== */
function showChecklist(){
  const neonOn = document.getElementById('neonOnSound');
  if (neonOn) {
    neonOn.pause();
    neonOn.currentTime = 0;
  }

  const neonFlicker = document.getElementById('neonFlickerSound');
  if (neonFlicker) {
    neonFlicker.pause();
    neonFlicker.currentTime = 0;
  }

  if (flickerInterval) {
    clearInterval(flickerInterval);
    flickerInterval = null;
  }

  const items = document.querySelectorAll('#checklist li');
  const nextBtn = document.getElementById('nextBtn');
  const compText = document.getElementById('compatibility');
  let delay = 300;
  const itemDelay = 800;

  items.forEach((li)=>{
    const span = li.querySelector('span');

    const oldCheck = li.querySelector('.check');
    if (oldCheck) oldCheck.remove();
    const oldGlow = li.querySelector('.check-glow');
    if (oldGlow) oldGlow.remove();

    const glowWrapper = document.createElement('span');
    glowWrapper.className = 'check-glow';

    const check = document.createElement('span');
    check.className = 'check';

    glowWrapper.appendChild(check);
    li.insertBefore(glowWrapper, span);

    span.style.opacity = '0';
    li.style.opacity = 1;
    li.style.transform = 'translateX(0)';

    setTimeout(()=>{
      span.style.opacity = '1';
      span.style.color = 'var(--text)';

      setTimeout(()=>{
        glowWrapper.style.opacity = 1;

        setTimeout(()=>{
          span.classList.add('neon');
          span.style.color = '#ffffff';
        }, 200);
      }, 200);
    }, delay);

    delay += itemDelay;
  });

  setTimeout(()=>{
    const neonSound = document.getElementById('neonOnSound');
    if (neonSound) {
      neonSound.currentTime = 0;
      neonSound.volume = 0.5;
      neonSound.play().catch(e => console.log("Sound play failed:", e));
    }

    compText.style.opacity = 1;
    compText.style.transition = 'opacity 1s ease';

    nextBtn.style.opacity = '1';
    nextBtn.style.transition = 'opacity 0.5s ease';

    setTimeout(()=>{
      nextBtn.disabled = false;
    }, 500);
  }, delay);
}

/* ===== –£–ë–ï–ì–ê–Æ–©–ê–Ø –ö–ù–û–ü–ö–ê "–ù–ï–¢" –° –®–£–¢–õ–ò–í–´–ú–ò –°–û–û–ë–©–ï–ù–ò–Ø–ú–ò ===== */
const noBtn = document.getElementById('noBtn');
let noClickCount = 0;
let noBtnHidden = false;

// –ú–∞—Å—Å–∏–≤ —à—É—Ç–ª–∏–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
const funnyMessages = [
  "üôà –ù–µ –ø–æ–ª—É—á–∏—Ç—Å—è!",
  "üòÖ –î–∞–∂–µ –Ω–µ –¥—É–º–∞–π!",
  "ü§î –¢—ã —É–≤–µ—Ä–µ–Ω–∞?",
  "üòè –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!",
  "üòÇ –°–µ—Ä—å—ë–∑–Ω–æ?",
  "üòú –ï—â—ë –ø–æ–ø—ã—Ç–∫–∞",
  "üëª –ë—É! –ù–µ –ø–æ–π–º–∞–ª–∞",
  "üåÄ –£—Å–∫–æ–ª—å–∑–Ω—É–ª–∞",
  "ü¶ë –£–ø–ª—ã–ª–∞",
  "ü¶ã –£–ª–µ—Ç–µ–ª–∞",
  "üå™Ô∏è –í–∏—Ö—Ä—å!",
  "üí® –í–µ—Ç—Ä–æ–º —Å–¥—É–ª–æ",
  "üï≥Ô∏è –í —á—ë—Ä–Ω—É—é –¥—ã—Ä—É",
  "üöÄ –£–º—á–∞–ª–∞—Å—å –≤ –∫–æ—Å–º–æ—Å",
  "üå† –ò—Å—á–µ–∑–ª–∞ –≤–æ –≤—Å–ø—ã—à–∫–µ",
  "üí™ –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë",
  "üèÉ‚Äç‚ôÄÔ∏è –î–æ–≥–æ–Ω—è–π!",
  "üßö‚Äç‚ôÄÔ∏è –§–µ—è —É–Ω–µ—Å–ª–∞"
];

// –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
function createMessageContainer() {
  let container = document.querySelector('.no-btn-messages');
  if (!container) {
    container = document.createElement('div');
    container.className = 'no-btn-messages';
    container.style.cssText = `
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      pointer-events: none;
      width: 90%;
      max-width: 320px;
    `;
    document.body.appendChild(container);
  }
  return container;
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —à—É—Ç–ª–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
function showFunnyMessage() {
  if (noBtnHidden) return;

  const container = createMessageContainer();
  
  // –ñ—ë—Å—Ç–∫–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è ‚Äî –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±–æ–ª—å—à–µ 3 —Å–æ–æ–±—â–µ–Ω–∏–π
  // –ï—Å–ª–∏ —É–∂–µ 3, —Å–Ω–∞—á–∞–ª–∞ –£–î–ê–õ–Ø–ï–ú —Å—Ç–∞—Ä–æ–µ, –ø–æ—Ç–æ–º —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ
  if (container.children.length >= 3) {
    const oldestMessage = container.firstChild;
    if (oldestMessage) {
      // –ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö
      oldestMessage.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
      oldestMessage.style.opacity = '0';
      oldestMessage.style.transform = 'translateY(-30px)';
      oldestMessage.style.marginBottom = '0';
      
      // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
      setTimeout(() => {
        if (oldestMessage.parentNode) {
          oldestMessage.remove();
          
          // –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
          addNewMessage(container);
        }
      }, 380);
    }
  } else {
    // –ï—Å–ª–∏ –º–µ–Ω—å—à–µ 3 —Å–æ–æ–±—â–µ–Ω–∏–π, –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ä–∞–∑—É
    addNewMessage(container);
  }
}

// –û—Ç–¥–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
function addNewMessage(container) {
  const message = document.createElement('div');

  // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  const randomIndex = Math.floor(Math.random() * funnyMessages.length);
  message.textContent = funnyMessages[randomIndex];

  // –ù–∞—á–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ - –Ω–µ–≤–∏–¥–∏–º–æ –∏ —Å–º–µ—â–µ–Ω–æ –≤–Ω–∏–∑
  message.style.cssText = `
    background: rgba(255, 79, 216, 0.95);
    color: #000;
    padding: 12px 20px;
    border-radius: 50px;
    font-weight: bold;
    font-size: 16px;
    box-shadow: 0 0 20px var(--neon-pink);
    border: 2px solid #ffffff;
    backdrop-filter: blur(5px);
    text-align: center;
    width: 100%;
    letter-spacing: 0.5px;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    margin-bottom: 12px;
  `;

  container.appendChild(message);

  // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ requestAnimationFrame
  requestAnimationFrame(() => {
    message.style.opacity = '1';
    message.style.transform = 'translateY(0)';
  });

  // –ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    message.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
    message.style.opacity = '0';
    message.style.transform = 'translateY(-30px)';
    message.style.marginBottom = '0';

    setTimeout(() => {
      if (message.parentNode) {
        message.remove();
      }
    }, 380);
  }, 2800);
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä—è—á–µ–º –∫–Ω–æ–ø–∫—É
function hideNoButton() {
  if (noBtnHidden) return;
  noBtnHidden = true;

  const container = createMessageContainer();
  container.innerHTML = '';

  // –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
  const finalMessage = document.createElement('div');
  finalMessage.style.cssText = `
    background: linear-gradient(135deg, #ff4fd8, #ff1a75);
    color: white;
    padding: 20px 24px;
    border-radius: 50px;
    font-weight: bold;
    font-size: 22px;
    box-shadow: 0 0 40px var(--neon-pink);
    border: 2px solid #ffffff;
    text-align: center;
    opacity: 0;
    transform: scale(0.7);
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
  `;
  finalMessage.textContent = '–ù–µ—Ç —Ç–∞–∫ –Ω–µ—Ç üôÉ';

  container.appendChild(finalMessage);

  // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  requestAnimationFrame(() => {
    finalMessage.style.opacity = '1';
    finalMessage.style.transform = 'scale(1)';
  });

  // –ü—Ä—è—á–µ–º –∫–Ω–æ–ø–∫—É —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  noBtn.style.transition = 'all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)';
  noBtn.style.opacity = '0';
  noBtn.style.transform = 'scale(0) rotate(180deg)';

  setTimeout(() => {
    noBtn.style.display = 'none';
  }, 500);

  // –í–∏–±—Ä–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
  if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 200]);

  // –ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  setTimeout(() => {
    finalMessage.style.opacity = '0';
    finalMessage.style.transform = 'scale(0.7)';

    setTimeout(() => {
      container.innerHTML = '';
    }, 500);
  }, 3000);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
function getRandomPosition(btnRect, areaRect) {
  const buttonDiagonal = Math.hypot(btnRect.width, btnRect.height);
  const minDistance = buttonDiagonal + 30;

  const minX = 10;
  const maxX = areaRect.width - btnRect.width - 10;
  const minY = 10;
  const maxY = areaRect.height - btnRect.height - 10;

  let newX, newY;
  let attempts = 0;
  const lastX = parseFloat(noBtn.style.left) || areaRect.width/2;
  const lastY = parseFloat(noBtn.style.top) || areaRect.height/2;

  do {
    newX = minX + Math.random() * (maxX - minX);
    newY = minY + Math.random() * (maxY - minY);
    attempts++;
    if (attempts > 10) break;
  } while (Math.hypot(newX - lastX, newY - lastY) < minDistance && attempts < 50);

  return { x: newX, y: newY };
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏
function moveNoButton() {
  if (noBtnHidden || !noBtn || noBtn.style.display === 'none') return;

  const noBtnArea = document.querySelector('#screen5 .no-btn-area');
  if (!noBtnArea) return;

  const btnRect = noBtn.getBoundingClientRect();
  const areaRect = noBtnArea.getBoundingClientRect();

  const newPos = getRandomPosition(btnRect, areaRect);

  noBtn.style.transition = 'all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1)';
  noBtn.style.left = newPos.x + 'px';
  noBtn.style.top = newPos.y + 'px';
  noBtn.style.transform = 'scale(0.9)';

  setTimeout(() => {
    noBtn.style.transform = 'scale(1)';
    noBtn.style.transition = 'all 0.3s ease';
  }, 250);

  noClickCount++;

  showFunnyMessage();

  if (noClickCount >= 20) {
    hideNoButton();
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
if (noBtn) {
  noBtn.removeEventListener('mouseenter', moveNoButton);
  noBtn.removeEventListener('touchstart', moveNoButton);
  noBtn.removeEventListener('click', moveNoButton);

  noBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    moveNoButton();
  });

  noBtn.addEventListener('touchstart', function(e) {
    e.preventDefault();
    moveNoButton();
  });
}

// –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ —Å—Ç–∏–ª–∏
const style = document.createElement('style');
style.textContent = `
  .no-btn-messages {
    transition: all 0.3s ease;
  }
`;
document.head.appendChild(style);

/* ===== –ê–ù–ò–ú–ê–¶–ò–Ø –†–ê–ó–õ–ï–¢–ê–Æ–©–ò–•–°–Ø –°–ï–†–î–ï–ß–ï–ö ===== */
function createHeartExplosion(event) {
  const hearts = ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú'];

  navigator.vibrate?.([100, 50, 100, 50, 100]);

  let clickX, clickY;
  if (event.type === 'touchstart') {
    clickX = event.touches[0].clientX;
    clickY = event.touches[0].clientY;
    event.preventDefault();
  } else {
    clickX = event.clientX;
    clickY = event.clientY;
  }

  for (let i = 0; i < 30; i++) {
    const heart = document.createElement('div');
    heart.className = 'heart-particle';

    heart.innerText = hearts[Math.floor(Math.random() * hearts.length)];
    heart.style.left = clickX + 'px';
    heart.style.top = clickY + 'px';

    const angle = Math.random() * Math.PI * 2;
    const velocity = 120 + Math.random() * 180;
    const tx = Math.cos(angle) * velocity;
    const ty = Math.sin(angle) * velocity;

    const rotate1 = Math.random() * 360 + 'deg';
    const rotate2 = Math.random() * 720 + 'deg';
    const rotate3 = Math.random() * 1080 + 'deg';

    heart.style.setProperty('--tx', tx + 'px');
    heart.style.setProperty('--ty', ty + 'px');
    heart.style.setProperty('--rotate', rotate1);
    heart.style.setProperty('--rotate2', rotate2);
    heart.style.setProperty('--rotate3', rotate3);

    heart.style.fontSize = (18 + Math.random() * 20) + 'px';
    heart.style.animationDelay = (Math.random() * 0.2) + 's';

    document.body.appendChild(heart);

    setTimeout(() => {
      if (heart.parentNode) heart.remove();
    }, 3000);
  }

  const specialHeart = document.createElement('div');
  specialHeart.className = 'heart-particle';
  specialHeart.innerText = 'ü•∞';
  specialHeart.style.left = clickX + 'px';
  specialHeart.style.top = clickY + 'px';
  specialHeart.style.fontSize = '35px';
  specialHeart.style.zIndex = '1001';

  const angle = Math.random() * Math.PI * 2;
  const velocity = 60 + Math.random() * 80;
  const tx = Math.cos(angle) * velocity;
  const ty = Math.sin(angle) * velocity;

  const rotate1 = Math.random() * 360 + 'deg';
  const rotate2 = Math.random() * 720 + 'deg';
  const rotate3 = Math.random() * 1080 + 'deg';

  specialHeart.style.setProperty('--tx', tx + 'px');
  specialHeart.style.setProperty('--ty', ty + 'px');
  specialHeart.style.setProperty('--rotate', rotate1);
  specialHeart.style.setProperty('--rotate2', rotate2);
  specialHeart.style.setProperty('--rotate3', rotate3);

  specialHeart.style.animation = 'heartExplode 4s ease-out forwards';
  specialHeart.style.animationDelay = (Math.random() * 0.1) + 's';

  document.body.appendChild(specialHeart);

  setTimeout(() => {
    if (specialHeart.parentNode) specialHeart.remove();
  }, 4000);
}

const hugBtn = document.getElementById('hugBtn');
if (hugBtn) {
  hugBtn.removeEventListener('click', createHeartExplosion);
  hugBtn.addEventListener('click', createHeartExplosion);
  hugBtn.addEventListener('touchstart', function(e) {
    e.preventDefault();
    createHeartExplosion(e);
  });
}
</script>

</body>
</html>
