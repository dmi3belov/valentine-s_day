<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíñ</title>
<style>
:root {
  --bg: #0b0b14;
  --neon-pink: #ff4fd8;
  --neon-blue: #4df0ff;
  --text: #ffffff;
  --card: rgba(255,255,255,0.06);
  --neon-green: #39ff14;
}

* { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }

body {
  margin: 0;
  background: radial-gradient(circle at top, #1a0033, var(--bg));
  color: var(--text);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–æ–ª–ª */
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
.screens-container {
  width: 100%;
  height: 100vh;
  overflow-y: auto; /* –°–∫—Ä–æ–ª–ª —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
  position: relative;
  scroll-behavior: smooth;
}

/* –ò–∑–º–µ–Ω—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ */
.screen {
  display: none;
  width: 100%;
  max-width: 420px;
  padding: 24px;
  text-align: center;
  animation: fadeIn 0.6s ease;
  margin: 0 auto;
  min-height: 100vh; /* –ö–∞–∂–¥—ã–π —ç–∫—Ä–∞–Ω –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é –≤—ã—Å–æ—Ç—É */
  flex-direction: column;
  justify-content: center; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
  align-items: center;
}

.screen.active {
  display: flex;
}

#screen4 {
  justify-content: flex-start; /* –ü—Ä–∏–∂–∏–º–∞–µ–º –∫ –≤–µ—Ä—Ö—É */
  padding-top: 10px; /* –ú–µ–Ω—å—à–∏–π –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
}

h1, h2 { text-shadow: 0 0 10px var(--neon-pink); }
p { line-height: 1.5; opacity: 0.95; }

.card {
  background: var(--card);
  border-radius: 20px;
  padding: 24px;
  box-shadow:
    0 0 20px rgba(255,79,216,0.2),
    inset 0 0 20px rgba(255,255,255,0.03);
  max-height: calc(100vh - 40px);
  overflow-y: auto;
}

#screen4 .card {
  padding-top: 12px;
  min-height: auto; /* –£–±–∏—Ä–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É */
  max-height: calc(100vh - 40px);
  overflow-y: auto; /* –†–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
  display: flex;
  flex-direction: column;
}

button {
  margin-top: 20px;
  padding: 14px 22px;
  border-radius: 999px;
  border: none;
  background: linear-gradient(135deg, var(--neon-pink), var(--neon-blue));
  color: #000;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 15px var(--neon-pink);
  transition: transform 0.2s ease;
}

button:active { transform: scale(0.95); }
button:disabled { opacity: .4; filter: grayscale(1); box-shadow: none; cursor: not-allowed; }

ul { list-style: none; padding: 0; text-align: left; margin-top: 20px; }
li { margin-bottom: 10px; opacity: 0; transform: translateX(-20px); display: flex; align-items: center; }
li .check { opacity: 0; margin-right: 10px; transition: opacity 0.3s ease; color: var(--neon-green); text-shadow: 0 0 4px var(--neon-green), 0 0 10px var(--neon-green); }
li span { color: var(--text); opacity: 1; transition: color 0.3s ease; }
li span.neon { color: #ffffff; text-shadow: 0 0 4px #ffffff, 0 0 10px #ffffff; }

/* –¢–µ–∫—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ */
#compatibility {
  opacity: 0;
  margin-top: 20px;
  text-align: center;
}
#compatibility .main {
  font-size: 18px;
  color: var(--neon-pink);/*--text*/
  text-shadow: 0 0 10px var(--neon-pink);
  font-weight: 750;
  animation: neonFlicker 4s infinite alternate;
}
#compatibility .sub {
  font-size: 14px;
  color: #ffffff;
  display: block;
  margin-top: 4px;
}

@keyframes neonGlow {
  0% { text-shadow: 0 0 8px var(--neon-pink), 0 0 15px var(--neon-pink); }
  100% { text-shadow: 0 0 12px var(--neon-pink), 0 0 25px var(--neon-pink); }
}

.progress {
  margin: 20px 0;
  height: 14px;
  border-radius: 999px;
  overflow: visible;
  background: rgba(255,255,255,0.1);
  position: relative;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue));
  box-shadow: 0 0 10px var(--neon-pink);
  border-radius: 999px;
  transition: width 0.2s linear;
}

#loadText { margin-top: 10px; font-weight: 600; letter-spacing: 1px; text-shadow: 0 0 8px var(--neon-blue); }
#errorText { margin-top: 6px; color: var(--neon-pink); font-size: 14px; opacity: 0; text-shadow: 0 0 10px var(--neon-pink); min-height:38px; transition: opacity 0.3s ease; }

.glitch { animation: glitch 0.2s linear infinite; }

@keyframes glitch {
  0%   { transform: translate(0); }
  20%  { transform: translate(-2px, 2px); }
  40%  { transform: translate(2px, -2px); }
  60%  { transform: translate(-2px, -1px); }
  80%  { transform: translate(1px, 2px); }
  100% { transform: translate(0); }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ª–∞–±–∏—Ä–∏–Ω—Ç–∞ */
.game-container {
  position: relative;
  margin: 6px auto 8px auto;
  border-radius: 0; /* –ü—Ä—è–º—ã–µ —É–≥–ª—ã */
  overflow: hidden;
  background: #000000; /* –ß—ë—Ä–Ω–∞—è –æ–∫–∞–Ω—Ç–æ–≤–∫–∞ */
  border: 0px solid rgba(255,255,255,0.07);
  width: 340px !important;
  height: 340px !important;
  padding: 5px; /* –û–∫–∞–Ω—Ç–æ–≤–∫–∞ 5px —Å–æ –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–Ω */
  box-sizing: border-box;
  flex-shrink: 0;
}

#mazeCanvas {
  display: block;
  width: 330px; /* –õ–∞–±–∏—Ä–∏–Ω—Ç 330√ó330 */
  height: 330px;
  background: #0a0a12;
  margin: 0 auto;
}

.player {
  position: absolute;
  width: 31px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ */
  height: 31px;
  /* –£–±—Ä–∞—Ç—å calc —Ñ–æ—Ä–º—É–ª—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é */
  top: 0; /* JavaScript –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —ç—Ç–æ */
  left: 0;
  border-radius: 50%;
  background: #4d8cff;
  box-shadow: 0 0 20px #4d8cff;
  transition: all 0.2s ease;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 17px;
  pointer-events: none;
}

.target {
  position: absolute;
  width: 28px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ */
  height: 28px;
  /* –£–±—Ä–∞—Ç—å calc —Ñ–æ—Ä–º—É–ª—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é */
  top: 0; /* JavaScript –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —ç—Ç–æ */
  left: 0;
  border-radius: 50%;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  z-index: 5;
  pointer-events: none;
  filter: drop-shadow(0 0 8px rgba(77, 240, 255, 0.9));
}

.collectible {
  position: absolute;
  width: 27px;
  height: 27px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--neon-pink), #ff6bff);
  box-shadow: 0 0 15px var(--neon-pink);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  z-index: 3;
  animation: float 3s ease-in-out infinite;
  pointer-events: none;
  transform: translateY(0); /* –ù–∞—á–∏–Ω–∞–µ–º —Å 0 */
}

@keyframes float {
  0% {
    transform: translateY(0);
  }
  25% {
    transform: translateY(2px);
  }
  75% {
    transform: translateY(-2px);
  }
  100% {
    transform: translateY(0);
  }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∞–±–∏—Ä–∏–Ω—Ç–æ–º */
/* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.maze-stats {
  display: flex;
  justify-content: space-around;
  padding: 8px 5px;
  background: rgba(255,255,255,0.05);
  border-radius: 10px;
}

.maze-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0 5px;
}

.maze-stat-value {
  font-size: 16px;
  font-weight: 700;
  text-shadow: 0 0 8px var(--neon-blue);
  line-height: 1;
}

.maze-stat-label {
  font-size: 10px;
  opacity: 0.8;
  margin-top: 2px;
}



/* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è —Å–µ–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
.maze-controls-section {
  margin: 2px 0 4px 0;
  position: relative;
  height: 120px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.maze-controls-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  width: 100%;
  transition: opacity 0.5s ease;
}

.maze-completion-message {
  opacity: 0;
  transform: translateY(15px);
  transition: all 0.5s ease;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  font-size: 0.85em;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 120px;
}

.maze-completion-message.show {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.maze-completion-message h3 {
  font-size: 1.1em;
  margin-bottom: 6px;
  color: var(--neon-pink);
  text-shadow: 0 0 12px var(--neon-pink);
}

.dpad {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 3px;
  width: 110px;
  height: 110px;
}

.dpad-btn {
  background: rgba(255,255,255,0.1);
  border: 2px solid var(--neon-pink);
  border-radius: 6px;
  color: var(--neon-pink);
  font-size: 23px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
  user-select: none;
  box-shadow: 0 0 8px rgba(255, 79, 216, 0.7);
}

.dpad-btn:active {
  background: var(--neon-pink);
  color: #000;
  transform: scale(0.95);
}

.dpad-btn.up { grid-column: 2; grid-row: 1; }
.dpad-btn.left { grid-column: 1; grid-row: 2; }
.dpad-btn.center { grid-column: 2; grid-row: 2; opacity: 0; }
.dpad-btn.right { grid-column: 3; grid-row: 2; }
.dpad-btn.down { grid-column: 2; grid-row: 3; }

.trail {
  position: absolute;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #4d8cff;
  opacity: 0.6;
  pointer-events: none;
  z-index: 1;
  animation: fadeTrail 2s ease-out forwards;
  box-shadow: 0 0 8px #4d8cff;
}

/* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞ */
.maze-action-buttons {
  display: flex;
  gap: 6px;
  justify-content: center;
  margin-top: 10px;
  flex-shrink: 0;
}

.maze-action-buttons button {
  min-width: 140px;
  max-width: 180px;
  font-size: 14px;
  padding: 12px 20px;
  margin-top: 0;
  background: linear-gradient(135deg, var(--neon-pink), var(--neon-blue));
  color: #000;
  font-weight: 700;
  border: none;
  border-radius: 999px;
  cursor: pointer;
  box-shadow: 0 0 15px var(--neon-pink);
  transition: all 0.2s ease;
  white-space: nowrap;
}

.maze-action-buttons button:active {
  transform: scale(0.95);
}

.maze-action-buttons button:disabled {
  opacity: 0.4;
  filter: grayscale(1);
  box-shadow: none;
  cursor: not-allowed;
}

/* –ß—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∏ –∑–∞–Ω–∏–º–∞–ª–∏ –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ */
.maze-action-buttons {
  display: flex;
  gap: 15px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
  justify-content: center;
  margin-top: 5px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–µ—Å—Ç–∞–º–∏ */
/*.mobile-hint {*/
/*  position: absolute;*/
/*  bottom: 15px;*/
/*  left: 50%;*/
/*  transform: translateX(-50%);*/
/*  background: rgba(0,0,0,0.8);*/
/*  color: white;*/
/*  padding: 10px 20px;*/
/*  border-radius: 30px;*/
/*  border: 2px solid var(--neon-blue);*/
/*  font-size: 14px;*/
/*  text-align: center;*/
/*  z-index: 100;*/
/*  animation: fadeInOutMobile 3s ease-in-out;*/
/*  max-width: 90%;*/
/*  display: flex;*/
/*  align-items: center;*/
/*  gap: 8px;*/
/*  backdrop-filter: blur(5px);*/
/*  box-shadow: 0 0 20px rgba(77, 240, 255, 0.3);*/
/*}*/
/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–µ—Å—Ç–∞–º–∏ */
.mobile-hint {
  position: absolute;
  bottom: 15px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.7);
  color: var(--neon-blue);
  padding: 8px 16px;
  border-radius: 16px;
  border: 2px solid var(--neon-blue);
  font-size: 13px;
  text-align: center;
  z-index: 100;
  animation: fadeInOutMobile 3s ease-in-out forwards; /* forwards - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω–µ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
  max-width: 90%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  line-height: 1.4;
  white-space: normal;
  backdrop-filter: blur(2px);
  box-shadow: 0 0 12px rgba(77, 240, 255, 0.3);
  opacity: 0; /* –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è */
}

.mobile-hint .hint-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  white-space: nowrap;
}

.mobile-hint .hint-icon {
  animation: swipeHint 1.2s ease-in-out infinite;
  display: inline-block;
  transform-origin: center;
  filter: drop-shadow(0 0 3px var(--neon-blue));
  font-size: 16px;
}

@keyframes swipeHint {
  0% { transform: translateX(-3px); }
  50% { transform: translateX(5px); }
  100% { transform: translateX(-3px); }
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è - –û–î–ò–ù–ê–ö–û–í–û –ø–ª–∞–≤–Ω–∞—è */
@keyframes fadeInOutMobile {
  0% {
    opacity: 0;
    transform: translateX(-50%) translateY(8px);
  }
  15% {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  85% {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  100% {
    opacity: 0;
    transform: translateX(-50%) translateY(8px);
  }
}

@keyframes pulseTarget {
  0% { transform: scale(1); filter: drop-shadow(0 0 6px rgba(77, 240, 255, 0.8)); }
  100% { transform: scale(1.1); filter: drop-shadow(0 0 12px rgba(77, 240, 255, 1)); }
}

@keyframes fadeTrail {
  0% {
    opacity: 1;
    transform: scale(1);
    box-shadow: 0 0 8px #4d8cff;
  }
  30% {
    opacity: 1;
    transform: scale(0.9);
    box-shadow: 0 0 4px #4d8cff;
  }
  100% {
    opacity: 0;
    transform: scale(0.7);
    box-shadow: 0 0 0px #4d8cff;
  }
}

.footer { margin-top: 30px; font-size: 12px; opacity: 0.4; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

#screen2 ul { padding-left: 60px; }

#checklist li {
  margin-bottom: 12px; /* –£–≤–µ–ª–∏—á–∏–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø—É–Ω–∫—Ç–∞–º–∏ */
  opacity: 0;
  transform: translateX(-20px);
  display: flex;
  align-items: center;
  font-size: 18px; /* –£–≤–µ–ª–∏—á–∏–º —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ */
}

#checklist li span {
  color: var(--text);
  opacity: 1;
  transition: color 0.3s ease;
  font-size: 18px; /* –£–≤–µ–ª–∏—á–∏–º —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ */
  font-weight: 500; /* –°–¥–µ–ª–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–µ–º–Ω–æ–≥–æ –∂–∏—Ä–Ω–µ–µ */
}

#checklist li .check {
  opacity: 0;
  margin-right: 15px; /* –£–≤–µ–ª–∏—á–∏–º –æ—Ç—Å—Ç—É–ø –æ—Ç –≥–∞–ª–æ—á–∫–∏ */
  transition: opacity 0.3s ease;
  color: var(--neon-green);
  text-shadow: 0 0 4px var(--neon-green), 0 0 10px var(--neon-green);
  font-size: 16px; /* –†–∞–∑–º–µ—Ä –≥–∞–ª–æ—á–∫–∏ */
}

#checklist li span.neon {
  color: #ffffff;
  text-shadow: 0 0 4px #ffffff, 0 0 10px #ffffff;
  font-size: 18px; /* –°–æ—Ö—Ä–∞–Ω—è–µ–º —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
}

/* SCREEN 3 —Å—Ç–∏–ª–∏ */
#screen3 .attention {
  text-shadow: 0 0 10px var(--neon-pink);
  font-size: 24px;
  margin-bottom: 24px;
}

#screen3 .problem {
  color: var(--neon-pink);
  font-size: 22px;
  font-weight: 600;
  text-shadow: 0 0 8px var(--neon-pink), 0 0 15px var(--neon-pink);
  animation: neonBlink 1.5s infinite alternate;
  margin-bottom: 20px;
}

@keyframes neonBlink {
  0% { opacity: 0.8; text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
  50% { opacity: 1; text-shadow: 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink), 0 0 30px var(--neon-pink); }
  100% { opacity: 0.8; text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
}

#screen3 .think-text {
  font-size: 22px;
  line-height: 1.6;
  color: var(--neon-blue);
  text-shadow: 0 0 8px var(--neon-blue), 0 0 15px var(--neon-blue);
  margin: 25px 0 15px 0;
}

#screen3 .message {
  font-size: 16px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.7);
  opacity: 0.7;
  margin: 10px 0 30px 0;
}

#screen3 .card {
  min-height: 300px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* SCREEN 5 —Å—Ç–∏–ª–∏ - –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã —Å —É–±–µ–≥–∞—é—â–µ–π –∫–Ω–æ–ø–∫–æ–π */
#screen5 {
  position: relative;
}

#screen5 .card {
  min-height: 320px;
  position: relative;
  overflow: visible;
}

#screen5 .buttons-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 0;
  gap: 10px;
}

#screen5 .yes-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
  width: 100%;
}

#screen5 .no-btn {
  position: absolute;
  left: 0;
  top: 0;
  margin: 0;
  background: linear-gradient(135deg, var(--neon-pink), var(--neon-blue));
  transition: all 0.3s ease;
  z-index: 10;
}

/* SCREEN 6 —Å—Ç–∏–ª–∏ */
#screen6 .loved-text {
  font-size: 20px;
  color: var(--text);
  margin: 20px 0;
}

#screen6 .loved-text .flicker {
  color: var(--neon-pink);
  text-shadow: 0 0 8px var(--neon-pink), 0 0 15px var(--neon-pink);
  animation: neonFlicker 2s infinite alternate;
  animation-delay: 0.5s;
  opacity: 0;
  animation-fill-mode: forwards;
}

/* –ö–ª–∞—Å—Å –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ */
.flicker-start {
  opacity: 1;
  animation-delay: 0s;
}

@keyframes neonFlicker {
  0%, 18%, 20%, 53%, 55%, 100% {
    opacity: 1;
    text-shadow:
      0 0 7px var(--neon-pink),
      0 0 10px var(--neon-pink),
      0 0 21px var(--neon-pink),
      0 0 42px var(--neon-pink),
      0 0 92px var(--neon-pink),
      0 0 102px var(--neon-pink);
  }
  19%, 54% {
    opacity: 0.6;
    text-shadow:
      0 0 4px var(--neon-pink),
      0 0 7px var(--neon-pink),
      0 0 14px var(--neon-pink),
      0 0 28px var(--neon-pink),
      0 0 60px var(--neon-pink),
      0 0 70px var(--neon-pink);
    color: #ff80ff; /* –°–ª–µ–≥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç –ø—Ä–∏ –º–µ—Ä—Ü–∞–Ω–∏–∏ */
  }
  2%, 8%, 14%, 30%, 36%, 42%, 58%, 64%, 70%, 86%, 92% {
    opacity: 0.9;
    text-shadow:
      0 0 6px var(--neon-pink),
      0 0 9px var(--neon-pink),
      0 0 18px var(--neon-pink),
      0 0 36px var(--neon-pink),
      0 0 76px var(--neon-pink),
      0 0 86px var(--neon-pink);
  }
  4%, 10%, 16%, 32%, 38%, 44%, 60%, 66%, 72%, 88%, 94% {
    opacity: 0.95;
    text-shadow:
      0 0 7px var(--neon-pink),
      0 0 10px var(--neon-pink),
      0 0 20px var(--neon-pink),
      0 0 40px var(--neon-pink),
      0 0 84px var(--neon-pink),
      0 0 94px var(--neon-pink);
  }
}

/* –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞–∑–ª–µ—Ç–∞—é—â–∏—Ö—Å—è —Å–µ—Ä–¥–µ—á–µ–∫ */
.heart-particle {
  position: fixed;
  font-size: 24px;
  pointer-events: none;
  z-index: 1000;
  animation: heartExplode 3s ease-out forwards;
  will-change: transform, opacity;
}

@keyframes heartExplode {
  0% {
    transform: translate(0, 0) scale(1) rotate(0deg);
    opacity: 1;
  }
  20% {
    transform: translate(var(--tx), var(--ty)) scale(1.2) rotate(var(--rotate));
    opacity: 0.9;
  }
  60% {
    transform: translate(calc(var(--tx) * 1.8), calc(var(--ty) * 1.8)) scale(1) rotate(var(--rotate2));
    opacity: 0.7;
  }
  100% {
    transform: translate(calc(var(--tx) * 2.5), calc(var(--ty) * 2.5)) scale(0.5) rotate(var(--rotate3));
    opacity: 0;
  }
}

#screen6 .footer {
  font-size: 14px;
  margin-top: 25px;
  opacity: 0.7;
}

#screen6 #hugBtn {
  position: relative;
  overflow: hidden;
}

#screen6 #hugBtn:active {
  transform: scale(0.95);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ —Å –æ–±–µ—â–∞–Ω–∏—è–º–∏ */
.promises-text {
  font-size: 18px;
  margin: 20px 0;
  text-align: center;
}

.promise-line {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 5px;
}

.promise-word {
  color: #ffffff;
  text-shadow: 0 0 4px #ffffff, 0 0 10px #ffffff;
}

.hug-word {
  color: #ffa8ff;
  text-shadow: 0 0 4px #ffa8ff, 0 0 10px #ffa8ff;
  animation: colorChangeHug 4s infinite alternate;
}

.kiss-word {
  color: #a8fffa;
  text-shadow: 0 0 4px #a8fffa, 0 0 10px #a8fffa;
  animation: colorChangeKiss 4s infinite alternate;
}

.funny-word {
  color: #ffd8a8;
  text-shadow: 0 0 4px #ffd8a8, 0 0 10px #ffd8a8;
  animation: colorChangeFunny 4s infinite alternate;
}

@keyframes colorChangeHug {
  0% { color: #ffa8ff; text-shadow: 0 0 4px #ffa8ff, 0 0 10px #ffa8ff; }
  33% { color: #ffc8ff; text-shadow: 0 0 4px #ffc8ff, 0 0 10px #ffc8ff; }
  66% { color: #ffe8ff; text-shadow: 0 0 4px #ffe8ff, 0 0 10px #ffe8ff; }
  100% { color: #ffa8ff; text-shadow: 0 0 4px #ffa8ff, 0 0 10px #ffa8ff; }
}

@keyframes colorChangeKiss {
  0% { color: #a8fffa; text-shadow: 0 0 4px #a8fffa, 0 0 10px #a8fffa; }
  33% { color: #c8fffc; text-shadow: 0 0 4px #c8fffc, 0 0 10px #c8fffc; }
  66% { color: #e8fffe; text-shadow: 0 0 4px #e8fffe, 0 0 10px #e8fffe; }
  100% { color: #a8fffa; text-shadow: 0 0 4px #a8fffa, 0 0 10px #a8fffa; }
}

@keyframes colorChangeFunny {
  0% { color: #ffd8a8; text-shadow: 0 0 4px #ffd8a8, 0 0 10px #ffd8a8; }
  33% { color: #ffe0c8; text-shadow: 0 0 4px #ffe0c8, 0 0 10px #ffe0c8; }
  66% { color: #ffe8e0; text-shadow: 0 0 4px #ffe8e0, 0 0 10px #ffe8e0; }
  100% { color: #ffd8a8; text-shadow: 0 0 4px #ffd8a8, 0 0 10px #ffd8a8; }
}

.promise-emoji {
  margin-left: 8px;
  font-size: 20px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ 4 */
#screen4 h2 {
  margin-top: 0;
  margin-bottom: 8px;
}

#screen4 > .card > p {
  margin-top: 0;
  margin-bottom: 10px;
}

/* –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–ª—è 4-–≥–æ —ç–∫—Ä–∞–Ω–∞ */
#screen4 .card::-webkit-scrollbar {
  width: 6px;
}

#screen4 .card::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

#screen4 .card::-webkit-scrollbar-thumb {
  background: var(--neon-pink);
  border-radius: 10px;
  box-shadow: 0 0 10px var(--neon-pink);
}

#screen4 .card::-webkit-scrollbar-thumb:hover {
  background: var(--neon-blue);
}

/* –î–ª—è Firefox */
#screen4 .card {
  scrollbar-width: thin;
  scrollbar-color: var(--neon-pink) rgba(255, 255, 255, 0.05);
}
@keyframes fadeInOut {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
  15% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  85% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
}

@keyframes fadeInOutMobile {
  0% { opacity: 0; transform: translateX(-50%) translateY(8px); }
  20% { opacity: 1; transform: translateX(-50%) translateY(0); }
  80% { opacity: 1; transform: translateX(-50%) translateY(0); }
  100% { opacity: 0; transform: translateX(-50%) translateY(8px); }
}

/* ===== –ü–†–û–°–¢–û–ô –ë–õ–û–ö –° –í–´–†–ê–í–ù–ò–í–ê–ù–ò–ï–ú –ü–û –ü–†–ê–í–û–ú–£ –ö–†–ê–Æ ===== */
.promise-block-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end; /* –í–°–Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –ü–†–ê–í–û–ú–£ –∫—Ä–∞—é */
  width: fit-content;
  margin: 20px auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –±–ª–æ–∫–∞ */
  font-size: 18px;
  line-height: 1.6;
  /* –ò–ó–ú–ï–ù–Ø–ô–¢–ï –¢–û–õ–¨–ö–û –≠–¢–û –ó–ù–ê–ß–ï–ù–ò–ï */
  padding-right: 30px; /* ‚Üê –í–û–¢ –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï –ú–ï–°–¢–û –î–õ–Ø –ù–ê–°–¢–†–û–ô–ö–ò */
  /* –£–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ (40px, 50px) ‚Üí –±–ª–æ–∫ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–ª–µ–≤–æ */
  /* –£–º–µ–Ω—å—à–∞–π—Ç–µ (20px, 10px, 0px) ‚Üí –±–ª–æ–∫ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–ø—Ä–∞–≤–æ */
}

.promise-line-right {
  white-space: nowrap;
  text-align: right; /* –¢–µ–∫—Å—Ç –ø—Ä–∏–∂–∞—Ç –∫ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
}

</style>
</head>
<body>
<!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã -->
<audio id="neonOnSound" preload="auto">
  <source src="sounds/neon-on.mp3" type="audio/mpeg">
</audio>

<audio id="neonFlickerSound" preload="auto">
  <source src="sounds/neon-flicker.mp3" type="audio/mpeg">
</audio>

<audio id="neonHumSound" preload="auto" loop>
  <source src="sounds/neon-hum.mp3" type="audio/mpeg">
</audio>

<div class="screens-container" id="screensContainer">
<!-- SCREEN 1 -->
<div class="screen active" id="screen1">
  <div class="card" style="min-height:250px; display:flex; flex-direction:column; justify-content:center;">
    <h2>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á—É–≤—Å—Ç–≤‚Ä¶</h2>
    <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É üíï</p>

    <div class="progress">
      <div class="progress-bar" id="loader"></div>
    </div>
    <p id="loadText">0%</p>
    <p id="errorText">
      –û–±–Ω–∞—Ä—É–∂–µ–Ω –∏–∑–±—ã—Ç–æ–∫ —á—É–≤—Å—Ç–≤<br>
      –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞...
    </p>

    <button id="continueBtn" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  </div>
</div>

<!-- SCREEN 2 -->
<div class="screen" id="screen2">
  <div class="card">
    <h2>–ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥—Ö–æ–¥–∏—à—å –ª–∏ —Ç—ã –º–Ω–µ üß†üíì</h2>
    <ul id="checklist">
      <li><span>–£–º–Ω–∞—è</span></li>
      <li><span>–ö—Ä–∞—Å–∏–≤–∞—è</span></li>
      <li><span>–ú–∏–ª–∞—è</span></li>
      <li><span>–°–º–µ—à–Ω–∞—è</span></li>
      <li><span>–í—Å—ë –µ—â—ë —á–∏—Ç–∞–µ—à—å —ç—Ç–æ</span></li>
    </ul>
    <p id="compatibility">
      <span class="main">100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</span><br>
      <span class="sub">(–î–∞, —è —Ç–æ–∂–µ —É–¥–∏–≤–ª—ë–Ω üòè)</span>
    </p>
    <button id="nextBtn" onclick="nextScreen(3)" disabled style="opacity: 0;">–ß—Ç–æ –¥–∞–ª—å—à–µ?</button>
  </div>
</div>

<!-- SCREEN 3 -->
<div class="screen" id="screen3">
  <div class="card">
    <div class="attention">–í–Ω–∏–º–∞–Ω–∏–µ!</div>
    <div class="problem">–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞</div>
    <div class="think-text">–Ø —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –¥—É–º–∞—é –æ —Ç–µ–±–µ</div>
    <p class="message">
      –ò—Å–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ —Å–æ–±–∏—Ä–∞—é—Å—å üòå
    </p>
    <button onclick="startMazeGame()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª—é–±–≤–∏</button>
  </div>
</div>

<!-- SCREEN 4 - –ò–ì–†–ê –í –õ–ê–ë–ò–†–ò–ù–¢ -->
<div class="screen" id="screen4">
  <div class="card">
    <h2>–õ–∞–±–∏—Ä–∏–Ω—Ç —á—É–≤—Å—Ç–≤ üåÄ</h2>
    <p>–ü—Ä–æ–≤–µ–¥–∏ —Å–µ—Ä–¥—Ü–µ —á–µ—Ä–µ–∑ –ª–∞–±–∏—Ä–∏–Ω—Ç –∫ —Ü–µ–ª–∏, —Å–æ–±–∏—Ä–∞—è —á–∞—Å—Ç–∏—á–∫–∏ –ª—é–±–≤–∏ –ø–æ –ø—É—Ç–∏</p>

    <div class="maze-stats">
      <div class="maze-stat">
        <div class="maze-stat-value" id="steps">0</div>
        <div class="maze-stat-label">–®–∞–≥–∏</div>
      </div>
      <div class="maze-stat">
        <div class="maze-stat-value" id="collected">0/5</div>
        <div class="maze-stat-label">–°–æ–±—Ä–∞–Ω–æ</div>
      </div>
      <div class="maze-stat">
        <div class="maze-stat-value" id="time">0</div>
        <div class="maze-stat-label">–°–µ–∫—É–Ω–¥—ã</div>
      </div>
    </div>

    <div class="game-container" id="gameContainer">
      <canvas id="mazeCanvas"></canvas>
      <div id="gameElements"></div>
    </div>

    <div class="maze-controls-section">
      <div id="mazeControlsContainer" class="maze-controls-container">
        <div class="dpad">
          <div class="dpad-btn up" onclick="movePlayer(0, -1)">‚¨ÜÔ∏è</div>
          <div class="dpad-btn left" onclick="movePlayer(-1, 0)">‚¨ÖÔ∏è</div>
          <div class="dpad-btn center"></div>
          <div class="dpad-btn right" onclick="movePlayer(1, 0)">‚û°Ô∏è</div>
          <div class="dpad-btn down" onclick="movePlayer(0, 1)">‚¨áÔ∏è</div>
        </div>
      </div>

      <div class="maze-completion-message" id="mazeCompletionMessage">
        <h3>–õ–∞–±–∏—Ä–∏–Ω—Ç –ø—Ä–æ–π–¥–µ–Ω! üèÜ</h3>
        <p>–¢—ã –Ω–∞—à–ª–∞ –ø—É—Ç—å –∫ –º–æ–µ–º—É —Å–µ—Ä–¥—Ü—É —á–µ—Ä–µ–∑ –≤—Å–µ –ø—Ä–µ–≥—Ä–∞–¥—ã! üíñ</p>
      </div>
    </div>

    <div class="maze-action-buttons">
      <button id="restartBtn" onclick="startMazeGame()">
        –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ üîÑ
      </button>
      <button id="nextMazeBtn" onclick="nextScreen(5)" disabled>
        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚ú®
      </button>
    </div>
  </div>
</div>

<!-- SCREEN 5 - –í–û–ü–†–û–° –ñ–ò–ó–ù–ò –ò –°–ï–†–î–¶–ê –° –£–ë–ï–ì–ê–Æ–©–ï–ô –ö–ù–û–ü–ö–û–ô -->
<div class="screen" id="screen5">
  <div class="card">
    <h2>–í–æ–ø—Ä–æ—Å –∂–∏–∑–Ω–∏ –∏ —Å–µ—Ä–¥—Ü–∞ üíò</h2>
    <p>–¢—ã —Å–æ–≥–ª–∞—Å–Ω–∞ –±—ã—Ç—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?</p>

    <div class="buttons-container">
      <div class="yes-buttons">
        <button onclick="nextScreen(6)">–î–∞ üíñ</button>
        <button onclick="nextScreen(6)">–ö–æ–Ω–µ—á–Ω–æ –¥–∞ üíò</button>
      </div>
      <button class="no-btn" id="noBtn">–ù–µ—Ç üôà</button>
    </div>
  </div>
</div>

<!-- SCREEN 6 -->
<div class="screen" id="screen6">
  <div class="card">
    <h1>–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! üíï</h1>
    <div class="loved-text">
      –¢—ã –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –º–æ–π —Å–∞–º—ã–π <span class="flicker">–ª—é–±–∏–º—ã–π</span> —á–µ–ª–æ–≤–µ–∫ üíñ
    </div>

    <!-- –ü–†–û–°–¢–û–ô –ë–õ–û–ö - –≤—Å—ë –≤—ã—Ä–æ–≤–Ω–µ–Ω–æ –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é -->
    <div class="promise-block-right">
      <div class="promise-line-right">
        <span class="promise-word">–û–±–µ—â–∞—é</span>
        <span>&nbsp;</span>
        <span class="hug-word">–æ–±–Ω–∏–º–∞—Ç—å</span>
        <span>ü§ó,</span>
      </div>

      <div class="promise-line-right">
        <span class="kiss-word">—Ü–µ–ª–æ–≤–∞—Ç—å</span>
        <span>üòò</span>
      </div>

      <div class="promise-line-right">
        <span class="promise-word">–∏</span>
        <span>&nbsp;</span>
        <span class="funny-word">—Å–º–µ—à–∏—Ç—å</span>
        <span>ü§™</span>
      </div>
    </div>


    <button id="hugBtn">–û–±–Ω—è—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</button>
    <div class="footer">
      –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –∏ –º—ã—Å–ª—è–º–∏ –æ —Ç–µ–±–µ üíï
    </div>
  </div>
</div>

<script>
// ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –õ–ê–ë–ò–†–ò–ù–¢–ê ====================
let gameActive = false;
let player = { x: 1, y: 1 };
let target = { x: 8, y: 8 };
let collectibles = [];
let steps = 0;
let collected = 0;
const REQUIRED_COLLECTIBLES = 5;
let timeElapsed = 0;
let maze = [];
let cellSize = 0;
let canvas, ctx;
let gameInterval;
let hasWon = false;

const MAZE_COLS = 10;
const MAZE_ROWS = 10;

// ==================== –ó–í–£–ö–ò –ù–ï–û–ù–û–í–û–ô –ê–ù–ò–ú–ê–¶–ò–ò ====================
let neonSoundInitialized = false;
let neonHumPlaying = false;
let flickerInterval;

function initNeonSounds() {
  if (neonSoundInitialized) return;

  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–≤—É–∫–æ–≤
  const sounds = ['neonOnSound', 'neonFlickerSound', 'neonHumSound'];
  sounds.forEach(soundId => {
    const audio = document.getElementById(soundId);
    if (audio) {
      audio.volume = 0.3;
      audio.load();
    }
  });

  neonSoundInitialized = true;
}

function playNeonOnSound() {
  const sound = document.getElementById('neonOnSound');
  if (sound) {
    sound.currentTime = 0;
    sound.volume = 0.4;
    sound.play().catch(e => console.log("Audio play failed:", e));

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—ã–π –≥—É–ª —á–µ—Ä–µ–∑ 200ms –ø–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è
    setTimeout(startNeonHum, 200);
  }
}

function playNeonFlickerSound() {
  const sound = document.getElementById('neonFlickerSound');
  if (sound) {
    sound.currentTime = 0;
    sound.volume = 0.2;
    sound.play().catch(e => console.log("Flicker sound play failed:", e));
  }
}

function startNeonHum() {
  if (neonHumPlaying) return;

  const hum = document.getElementById('neonHumSound');
  if (hum) {
    hum.volume = 0.1;
    hum.loop = true;
    hum.play().catch(e => console.log("Hum sound play failed:", e));
    neonHumPlaying = true;
  }
}

function stopNeonHum() {
  const hum = document.getElementById('neonHumSound');
  if (hum) {
    hum.pause();
    hum.currentTime = 0;
    neonHumPlaying = false;
  }
}

function startNeonAnimation() {
  const flickerElement = document.querySelector('.flicker');
  if (!flickerElement) return;

  // 1. –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω–∏—è
  playNeonOnSound();

  // 2. –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
  setTimeout(() => {
    flickerElement.classList.add('flicker-start');

    // 3. –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –∑–≤—É–∫–æ–≤ –º–µ—Ä—Ü–∞–Ω–∏—è
    startFlickerSoundInterval();
  }, 300);
}

function startFlickerSoundInterval() {
  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, –µ—Å–ª–∏ –µ—Å—Ç—å
  if (flickerInterval) clearInterval(flickerInterval);

  // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –º–µ—Ä—Ü–∞–Ω–∏—è –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã (–ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–¥ –∞–Ω–∏–º–∞—Ü–∏—é)
  flickerInterval = setInterval(() => {
    // –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
    const randomDelay = Math.random() * 500;
    setTimeout(playNeonFlickerSound, randomDelay);
  }, 2000);
}

function stopNeonAnimation() {
  const flickerElement = document.querySelector('.flicker');
  if (flickerElement) {
    flickerElement.classList.remove('flicker-start');
  }

  if (flickerInterval) {
    clearInterval(flickerInterval);
    flickerInterval = null;
  }

  stopNeonHum();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–≤—É–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(initNeonSounds, 1000);
});

// ==================== –§–£–ù–ö–¶–ò–ò –õ–ê–ë–ò–†–ò–ù–¢–ê ====================
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã-–ª–∞–±–∏—Ä–∏–Ω—Ç–∞
function initMazeGame() {
  canvas = document.getElementById('mazeCanvas');
  ctx = canvas.getContext('2d');

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä canvas 330√ó330
  canvas.width = 330;
  canvas.height = 330;
  cellSize = canvas.width / MAZE_COLS; // 33

  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  const container = document.getElementById('gameContainer');
  container.style.width = '340px';
  container.style.height = '340px';
  container.style.padding = '5px';
  container.style.borderRadius = '0';

  setupTouchControls();

  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
  gameActive = false;
  steps = 0;
  collected = 0;
  timeElapsed = 0;
  hasWon = false;

  // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  document.getElementById('steps').textContent = '0';
  document.getElementById('collected').textContent = '0/' + REQUIRED_COLLECTIBLES;
  document.getElementById('time').textContent = '0';

  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º UI
  document.getElementById('mazeControlsContainer').style.opacity = '1';
  document.getElementById('mazeCompletionMessage').classList.remove('show');
  document.getElementById('nextMazeBtn').disabled = true;

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ª–∞–±–∏—Ä–∏–Ω—Ç
  generateMaze();
  drawMaze();
  drawGameElements();

  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
  if (gameInterval) clearInterval(gameInterval);
  gameInterval = setInterval(updateTimer, 1000);
  gameActive = true;

  if (window.innerWidth <= 768) {
    showMobileHint();
  }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞
function generateMaze() {
  const rows = MAZE_ROWS;
  const cols = MAZE_COLS;
  maze = [];

  for (let y = 0; y < rows; y++) {
    maze[y] = [];
    for (let x = 0; x < cols; x++) {
      maze[y][x] = {
        top: true,
        right: true,
        bottom: true,
        left: true,
        visited: false
      };
    }
  }

  const stack = [];
  let current = { x: 0, y: 0 };
  maze[0][0].visited = true;

  while (true) {
    const neighbors = [];

    if (current.y > 0 && !maze[current.y - 1][current.x].visited) {
      neighbors.push({ x: current.x, y: current.y - 1, dir: 'top' });
    }
    if (current.x < cols - 1 && !maze[current.y][current.x + 1].visited) {
      neighbors.push({ x: current.x + 1, y: current.y, dir: 'right' });
    }
    if (current.y < rows - 1 && !maze[current.y + 1][current.x].visited) {
      neighbors.push({ x: current.x, y: current.y + 1, dir: 'bottom' });
    }
    if (current.x > 0 && !maze[current.y][current.x - 1].visited) {
      neighbors.push({ x: current.x - 1, y: current.y, dir: 'left' });
    }

    if (neighbors.length > 0) {
      const next = neighbors[Math.floor(Math.random() * neighbors.length)];
      stack.push(current);

      if (next.dir === 'top') {
        maze[current.y][current.x].top = false;
        maze[next.y][next.x].bottom = false;
      } else if (next.dir === 'right') {
        maze[current.y][current.x].right = false;
        maze[next.y][next.x].left = false;
      } else if (next.dir === 'bottom') {
        maze[current.y][current.x].bottom = false;
        maze[next.y][next.x].top = false;
      } else if (next.dir === 'left') {
        maze[current.y][current.x].left = false;
        maze[next.y][next.x].right = false;
      }

      maze[next.y][next.x].visited = true;
      current = { x: next.x, y: next.y };
    } else if (stack.length > 0) {
      current = stack.pop();
    } else {
      break;
    }
  }

  // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—ã
  for (let i = 0; i < 5; i++) {
    const x = Math.floor(Math.random() * (cols - 1));
    const y = Math.floor(Math.random() * (rows - 1));

    if (Math.random() > 0.5) {
      maze[y][x].right = false;
      if (x < cols - 1) maze[y][x + 1].left = false;
    } else {
      maze[y][x].bottom = false;
      if (y < rows - 1) maze[y + 1][x].top = false;
    }
  }

  player = { x: 1, y: 1 };
  target = { x: cols - 2, y: rows - 2 };

  collectibles = [];
  const totalCollectibles = 12;

  for (let i = 0; i < totalCollectibles; i++) {
    let x, y;
    do {
      x = Math.floor(Math.random() * cols);
      y = Math.floor(Math.random() * rows);
    } while ((x === player.x && y === player.y) || (x === target.x && y === target.y) ||
             collectibles.some(c => c.x === x && c.y === y));

    collectibles.push({
      x: x,
      y: y,
      collected: false,
      emoji: ['üíñ', 'üíï', 'üíó', 'üíì', 'üíû', 'üíù', 'üíò', 'üíü'][i % 8],
      id: `collectible_${i}`
    });
  }
}

// –†–∏—Å–æ–≤–∞–Ω–∏–µ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞
function drawMaze() {
  const rows = MAZE_ROWS;
  const cols = MAZE_COLS;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = '#0a0a12';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
  ctx.lineWidth = 2;

  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      const cell = maze[y][x];
      const px = x * cellSize;
      const py = y * cellSize;

      if (cell.top) {
        ctx.beginPath();
        ctx.moveTo(px, py);
        ctx.lineTo(px + cellSize, py);
        ctx.stroke();
      }

      if (cell.right) {
        ctx.beginPath();
        ctx.moveTo(px + cellSize, py);
        ctx.lineTo(px + cellSize, py + cellSize);
        ctx.stroke();
      }

      if (cell.bottom) {
        ctx.beginPath();
        ctx.moveTo(px, py + cellSize);
        ctx.lineTo(px + cellSize, py + cellSize);
        ctx.stroke();
      }

      if (cell.left) {
        ctx.beginPath();
        ctx.moveTo(px, py);
        ctx.lineTo(px, py + cellSize);
        ctx.stroke();
      }
    }
  }

  ctx.fillStyle = 'rgba(255, 79, 216, 0.03)';
  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      const px = x * cellSize;
      const py = y * cellSize;
      ctx.fillRect(px + 1, py + 1, cellSize - 2, cellSize - 2);
    }
  }
}

// –†–∏—Å–æ–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
function drawGameElements() {
  const gameElements = document.getElementById('gameElements');
  gameElements.innerHTML = '';

  // –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –æ–∫–∞–Ω—Ç–æ–≤–∫–∏ (padding –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
  const offset = 5; // padding: 5px

  // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–≥—Ä–æ–∫–∞
  const playerElement = document.createElement('div');
  playerElement.className = 'player';
  playerElement.textContent = 'üíñ';
  // cellSize = 33, cellSize/2 = 16.5
  // –ò–≥—Ä–æ–∫ 31px, —Å–º–µ—â–µ–Ω–∏–µ -15.5 = —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏
  // + offset = —Å–¥–≤–∏–≥ –Ω–∞ padding –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  playerElement.style.left = (offset + player.x * cellSize + 16.5 - 15.5) + 'px';
  playerElement.style.top = (offset + player.y * cellSize + 16.5 - 15.5) + 'px';
  gameElements.appendChild(playerElement);

  // –°–æ–∑–¥–∞–µ–º —Ü–µ–ª—å
  const targetElement = document.createElement('div');
  targetElement.className = 'target';
  targetElement.textContent = 'üéØ';
  // –¶–µ–ª—å 28px, —Å–º–µ—â–µ–Ω–∏–µ -14 = —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏
  targetElement.style.left = (offset + target.x * cellSize + 16.5 - 14) + 'px';
  targetElement.style.top = (offset + target.y * cellSize + 16.5 - 14) + 'px';
  gameElements.appendChild(targetElement);

  // –°–æ–∑–¥–∞–µ–º —Å–æ–±–∏—Ä–∞–µ–º—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
  collectibles.forEach((item, index) => {
    if (!item.collected) {
      const collectible = document.createElement('div');
      collectible.className = 'collectible';
      collectible.setAttribute('data-id', item.id);
      collectible.textContent = item.emoji;
      // –ö–æ–ª–ª–µ–∫—Ç–∞–±–ª—å 27px, —Å–º–µ—â–µ–Ω–∏–µ -13.5 = —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏
      collectible.style.left = (offset + item.x * cellSize + 16.5 - 13.5) + 'px';
      collectible.style.top = (offset + item.y * cellSize + 16.5 - 13.5) + 'px';
      collectible.style.animationDelay = (index * 0.2) + 's';
      gameElements.appendChild(collectible);
    }
  });
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
function setupTouchControls() {
  let touchStartX = 0;
  let touchStartY = 0;

  canvas.addEventListener('touchstart', (e) => {
    if (!gameActive) return;
    e.preventDefault();

    const touch = e.touches[0];
    touchStartX = touch.clientX;
    touchStartY = touch.clientY;
  }, { passive: false });

  canvas.addEventListener('touchend', (e) => {
    if (!gameActive) return;
    e.preventDefault();

    const touch = e.changedTouches[0];
    const deltaX = touch.clientX - touchStartX;
    const deltaY = touch.clientY - touchStartY;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    let dx = 0, dy = 0;
    if (Math.abs(deltaX) > Math.abs(deltaY)) {
      if (deltaX > 25) dx = 1;
      if (deltaX < -25) dx = -1;
    } else {
      if (deltaY > 25) dy = 1;
      if (deltaY < -25) dy = -1;
    }

    // –ü–†–û–í–ï–†–Ø–ï–ú, –ú–û–ñ–ù–û –õ–ò –¢–£–î–ê –ü–û–ô–¢–ò
    if (dx !== 0 || dy !== 0) {
      const newX = player.x + dx;
      const newY = player.y + dy;

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
      if (newX < 0 || newX >= MAZE_COLS || newY < 0 || newY >= MAZE_ROWS) {
        // –ó–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π –ª–∞–±–∏—Ä–∏–Ω—Ç–∞ - –≤–∏–±—Ä–∞—Ü–∏—è –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        if (navigator.vibrate) navigator.vibrate(80);
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–µ–Ω—ã
      const cell = maze[player.y][player.x];
      if ((dx === 1 && cell.right) || (dx === -1 && cell.left) ||
          (dy === 1 && cell.bottom) || (dy === -1 && cell.top)) {
        // –°—Ç–µ–Ω–∞ - –≤–∏–±—Ä–∞—Ü–∏—è
        if (navigator.vibrate) navigator.vibrate(80);
        return;
      }

      // –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´ - –î–í–ò–ì–ê–ï–ú–°–Ø
      movePlayer(dx, dy);
    }
  }, { passive: false });
}

// –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
function movePlayer(dx, dy) {
  if (!gameActive) return;

  const newX = player.x + dx;
  const newY = player.y + dy;

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –°–¢–ê–†–£–Æ –ø–æ–∑–∏—Ü–∏—é –î–û –¥–≤–∏–∂–µ–Ω–∏—è
  const oldX = player.x;
  const oldY = player.y;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
  if (newX < 0 || newX >= MAZE_COLS || newY < 0 || newY >= MAZE_ROWS) {
    return;
  }

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–µ–Ω—ã
  const cell = maze[player.y][player.x];
  if ((dx === 1 && cell.right) || (dx === -1 && cell.left) ||
      (dy === 1 && cell.bottom) || (dy === -1 && cell.top)) {
    if (navigator.vibrate) navigator.vibrate(80);
    return;
  }

  // –°–û–ó–î–ê–Å–ú –°–õ–ï–î –ù–ê –°–¢–ê–†–û–ô –ü–û–ó–ò–¶–ò–ò (–≥–¥–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ –±—ã–ª –∏–≥—Ä–æ–∫)
  createTrail(oldX, oldY);

  // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞
  player.x = newX;
  player.y = newY;
  steps++;
  document.getElementById('steps').textContent = steps;

  // –í–∏–±—Ä–∞—Ü–∏—è —à–∞–≥–∞
  if (navigator.vibrate) navigator.vibrate(20);

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–±–æ—Ä –∫–æ–ª–ª–µ–∫—Ç–∞–±–ª–µ–π
  collectibles.forEach(item => {
    if (!item.collected && item.x === player.x && item.y === player.y) {
      item.collected = true;
      collected++;
      document.getElementById('collected').textContent = collected + '/' + REQUIRED_COLLECTIBLES;
      if (navigator.vibrate) navigator.vibrate([40, 40, 80]);

      const element = document.querySelector(`[data-id="${item.id}"]`);
      if (element) element.remove();
    }
  });

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏
  if (player.x === target.x && player.y === target.y) {
    if (collected >= REQUIRED_COLLECTIBLES) {
      completeMazeGame();
    } else {
      showNeedMoreCollectibles();
    }
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞ (–ø–ª–∞–≤–Ω–æ —á–µ—Ä–µ–∑ CSS transition)
  updatePlayerPosition();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
function updatePlayerPosition() {
  const playerElement = document.querySelector('.player');
  if (playerElement) {
    const offset = 5; // padding –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    playerElement.style.left = (offset + player.x * cellSize + 16.5 - 15.5) + 'px';
    playerElement.style.top = (offset + player.y * cellSize + 16.5 - 15.5) + 'px';
  }
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –∫–æ–ª–ª–µ–∫—Ç–∞–±–ª–µ–π
function showNeedMoreCollectibles() {
  // –í–∏–±—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏
  if (navigator.vibrate) navigator.vibrate([100, 50, 100]);

  const message = document.createElement('div');
  message.style.cssText = `
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.85);
    color: var(--neon-pink);
    padding: 12px 20px;
    border-radius: 15px;
    border: 2px solid var(--neon-pink);
    font-weight: bold;
    text-align: center;
    z-index: 1000;
    animation: fadeInOut 1.5s ease forwards;
    pointer-events: none;
    box-shadow: 0 0 20px rgba(255, 79, 216, 0.5);
  `;

  const needed = REQUIRED_COLLECTIBLES - collected;
  message.innerHTML = `–ù—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –µ—â–µ ${needed} —á–∞—Å—Ç–∏—á–µ–∫ –ª—é–±–≤–∏! üíñ`;

  document.getElementById('gameContainer').appendChild(message);

  setTimeout(() => {
    if (message.parentNode) message.remove();
  }, 1500);
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–µ–¥–∞ - —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
function createTrail(x, y) {
  const trail = document.createElement('div');
  trail.className = 'trail';
  const offset = 5; // padding –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  trail.style.left = (offset + x * cellSize + 16.5 - 3) + 'px';
  trail.style.top = (offset + y * cellSize + 16.5 - 3) + 'px';

  document.getElementById('gameElements').appendChild(trail);

  setTimeout(() => {
    if (trail.parentNode) trail.remove();
  }, 1500);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
function updateTimer() {
  if (!gameActive) return;

  timeElapsed++;
  document.getElementById('time').textContent = timeElapsed;
}

// –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã-–ª–∞–±–∏—Ä–∏–Ω—Ç–∞
function startMazeGame() {
  // –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω 4
  nextScreen(4);

  // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É —ç–∫—Ä–∞–Ω–∞, –∑–∞—Ç–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
  setTimeout(() => {
    initMazeGame();
  }, 50);
}

// –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
function showMobileHint() {
  const hint = document.createElement('div');
  hint.className = 'mobile-hint';

  hint.innerHTML = `
    <div class="hint-row">
      <span class="hint-icon">üëÜ</span>
      <span>–°–≤–∞–π–ø–∞–π –ø–æ —ç–∫—Ä–∞–Ω—É</span>
    </div>
    <div>–¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è</div>
  `;

  document.querySelector('.game-container').appendChild(hint);

  // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã (—Ä–æ–≤–Ω–æ –∫–æ–≥–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –∞–Ω–∏–º–∞—Ü–∏—è)
  setTimeout(() => {
    if (hint.parentNode) hint.remove();
  }, 3000);
}

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã (–ø–æ–±–µ–¥–∞)
function completeMazeGame() {
  gameActive = false;
  hasWon = true;
  clearInterval(gameInterval);

  if (navigator.vibrate) navigator.vibrate([80, 40, 80, 40, 150]);

  const mazeControlsContainer = document.getElementById('mazeControlsContainer');
  const mazeCompletionMessage = document.getElementById('mazeCompletionMessage');
  const nextMazeBtn = document.getElementById('nextMazeBtn');

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–±—Ä–∞–Ω—ã –ª–∏ –í–°–ï 5 —á–∞—Å—Ç–∏—á–µ–∫
  const totalCollectibles = collectibles.length; // 12
  if (collected >= totalCollectibles) {
    // –í—Å–µ —Å–æ–±—Ä–∞–Ω—ã ‚Äî –ò–î–ï–ê–õ–¨–ù–û!
    mazeCompletionMessage.innerHTML = `
      <h3 style="color: var(--neon-pink); text-shadow: 0 0 12px var(--neon-pink);">
        üíñ –ò–î–ï–ê–õ–¨–ù–û! üíñ
      </h3>
      <p style="color: var(--neon-blue); text-shadow: 0 0 8px var(--neon-blue); font-size: 1.1em;">
        –¢—ã —Å–æ–±—Ä–∞–ª–∞ –í–°–ï —á–∞—Å—Ç–∏—á–∫–∏ –ª—é–±–≤–∏!
      </p>
    `;
  } else {
    // –ù–µ –≤—Å–µ —Å–æ–±—Ä–∞–Ω—ã ‚Äî –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    mazeCompletionMessage.innerHTML = `
      <h3 style="color: var(--neon-pink); text-shadow: 0 0 12px var(--neon-pink);">
        –õ–∞–±–∏—Ä–∏–Ω—Ç –ø—Ä–æ–π–¥–µ–Ω! üèÜ
      </h3>
      <p>–¢—ã —Å–æ–±—Ä–∞–ª–∞ ${collected} –∏–∑ ${REQUIRED_COLLECTIBLES} —á–∞—Å—Ç–∏—á–µ–∫ –ª—é–±–≤–∏! üíñ</p>
    `;
  }

  mazeControlsContainer.style.opacity = '0';
  setTimeout(() => {
    mazeCompletionMessage.classList.add('show');
  }, 300);

  nextMazeBtn.disabled = false;
  createFireworks();
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∞
function createFireworks() {
  const container = document.querySelector('.game-container');
  const offset = 5; // padding –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

  for (let i = 0; i < 15; i++) {
    setTimeout(() => {
      const firework = document.createElement('div');
      const xPos = offset + Math.random() * (canvas.width - 30) + 15;
      const yPos = offset + Math.random() * (canvas.height - 30) + 15;

      firework.style.cssText = `
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: ${Math.random() > 0.5 ? 'var(--neon-pink)' : 'var(--neon-blue)'};
        left: ${xPos}px;
        top: ${yPos}px;
        animation: explode 0.8s ease-out forwards;
        pointer-events: none;
        z-index: 1000;
      `;

      container.appendChild(firework);

      setTimeout(() => {
        if (firework.parentNode) firework.remove();
      }, 800);
    }, i * 80);
  }
}

// ==================== –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô –ö–û–î –í–ê–õ–ï–ù–¢–ò–ù–ö–ò ====================
let current = 4;

function nextScreen(n){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  current = n;
  document.getElementById(`screen${n}`).classList.add('active');

  // –í—ã–∑—ã–≤–∞–µ–º showChecklist –Ω–∞ —ç–∫—Ä–∞–Ω–µ 2
  if (n === 2) {
    showChecklist();
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–ù–µ—Ç" –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —ç–∫—Ä–∞–Ω 5
  if (n === 5 && window.noBtn && !window.noBtnInitialized) {
    setTimeout(() => {
      initNoButtonPosition();
    }, 100);
  }

  // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–µ–æ–Ω–æ–≤—É—é –∞–Ω–∏–º–∞—Ü–∏—é –Ω–∞ —ç–∫—Ä–∞–Ω–µ 6
  if (n === 6) {
    setTimeout(() => {
      startNeonAnimation();
    }, 500); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É —ç–∫—Ä–∞–Ω–∞
  } else {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é, –µ—Å–ª–∏ —É—Ö–æ–¥–∏–º —Å —ç–∫—Ä–∞–Ω–∞ 6
    stopNeonAnimation();
  }
}

// ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ö–†–û–õ–õ–û–ú ====================
function setupScrollBehavior() {
  const screensContainer = document.getElementById('screensContainer');

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
  const originalNextScreen = window.nextScreen;

  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–∫—Ä–æ–ª–ª–∞
  window.nextScreen = function(n) {
    originalNextScreen(n);

    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä–æ–ª–ª
    setTimeout(() => {
      if (current === 4) {
        // –ù–∞ 4-–º —ç–∫—Ä–∞–Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª
        screensContainer.style.overflowY = 'auto';
        screensContainer.scrollTo({
          top: document.getElementById('screen4').offsetTop,
          behavior: 'instant'
        });
      } else {
        // –ù–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö –±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª
        screensContainer.style.overflowY = 'hidden';
        screensContainer.scrollTo({
          top: document.getElementById(`screen${current}`).offsetTop,
          behavior: 'instant'
        });
      }
    }, 10);
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  setTimeout(() => {
    screensContainer.style.overflowY = 'hidden';
  }, 100);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', setupScrollBehavior);

/* ===== LOADER ===== */
const loader = document.getElementById('loader');
const loadText = document.getElementById('loadText');
const errorText = document.getElementById('errorText');
const continueBtn = document.getElementById('continueBtn');

let progress = 0;
let attempt = 1;
let pausePoints = [];

function generatePausePoints(){
  pausePoints = [];
  while(pausePoints.length<3){
    let point = Math.floor(Math.random()*80)+10;
    if(!pausePoints.includes(point)) pausePoints.push(point);
  }
  pausePoints.sort((a,b)=>a-b);
}
generatePausePoints();

function animateProgress(to, callback){
  const step = ()=>{
    if(progress < to){
      progress += 0.5;
      if(progress > to) progress = to;
      loader.style.width = progress+'%';
      let percent = Math.floor(progress);
      loadText.innerText = percent + '%';

      if(progress > 100){
        loader.style.background = 'linear-gradient(90deg, #ff1a75, #ff4fd8)';
        loader.style.boxShadow = '0 0 15px #ff1a75,0 0 30px #ff4fd8';
        loadText.style.color = '#ff1a75';
        loadText.style.textShadow = '0 0 8px #ff1a75';
      } else {
        loader.style.background = 'linear-gradient(90deg, var(--neon-pink), var(--neon-blue))';
        loader.style.boxShadow = '0 0 10px var(--neon-pink)';
        loadText.style.color = 'var(--text)';
        loadText.style.textShadow = '0 0 8px var(--neon-blue)';
      }

      if(pausePoints.includes(Math.floor(progress)) && progress<=100){
        setTimeout(()=>requestAnimationFrame(step),400);
      } else {
        requestAnimationFrame(step);
      }
    } else if(callback) callback();
  };
  requestAnimationFrame(step);
}

function animateRollback(to, callback){
  const step = ()=>{
    if(progress > to){
      progress -= 1;
      if(progress < to) progress = to;
      loader.style.width = progress+'%';
      loadText.innerText = Math.floor(progress)+'%';
      if(progress <=100){
        loader.style.background = 'linear-gradient(90deg, var(--neon-pink), var(--neon-blue))';
        loader.style.boxShadow = '0 0 10px var(--neon-pink)';
        loadText.style.color = 'var(--text)';
        loadText.style.textShadow = '0 0 8px var(--neon-blue)';
      }
      requestAnimationFrame(step);
    } else if(callback) callback();
  };
  requestAnimationFrame(step);
}

function pauseOverload(){
  errorText.style.opacity=1;
  setTimeout(()=>{
    animateRollback(0, ()=>{
      errorText.style.opacity=0;
      attempt=2;
      setTimeout(startLoading, 500);
    });
  },1500);
}

function startLoading(){
  if(attempt===1) progress=0;
  const interval = setInterval(()=>{
    let nextStep = progress + (Math.random()*6+4);
    if(attempt===1 && progress < 98){
      if(nextStep > 98) nextStep = 98;
      animateProgress(nextStep);
      return;
    }
    if(attempt===1 && progress >= 98){
      clearInterval(interval);
      const overload = Math.floor(Math.random()*9+101);
      setTimeout(()=>{ animateProgress(overload, pauseOverload); }, 500);
      return;
    }
    if(attempt===2 && nextStep >= 100){
      nextStep = 100;
      clearInterval(interval);
      animateProgress(nextStep, ()=>{continueBtn.disabled=false});
      return;
    }
    animateProgress(nextStep);
  }, Math.random()*250+150);
}

setTimeout(startLoading, Math.random()*500+500);
continueBtn.addEventListener('click', ()=> nextScreen(2));

/* ===== SCREEN 2 CHECKLIST ===== */
function showChecklist(){
  const items = document.querySelectorAll('#checklist li');
  const nextBtn = document.getElementById('nextBtn');
  const compText = document.getElementById('compatibility');
  let delay = 300;
  const itemDelay = 800;

  items.forEach((li)=>{
    const span = li.querySelector('span');
    const check = document.createElement('span');
    check.className = 'check';
    check.innerText = '‚úîÔ∏è';
    li.insertBefore(check, span);

    span.style.opacity = '0';
    li.style.opacity = 1;
    li.style.transform = 'translateX(0)';

    setTimeout(()=>{
      span.style.opacity = '1';
      span.style.color = 'var(--text)';

      setTimeout(()=>{
        check.style.opacity = 1;
        setTimeout(()=>{
          span.classList.add('neon');
          span.style.color = '#ffffff';
        }, 200);
      }, 200);
    }, delay);

    delay += itemDelay;
  });

  setTimeout(()=>{
    // 1. –ü–†–û–ò–ì–†–´–í–ê–ï–ú –ó–í–£–ö
    const neonSound = document.getElementById('neonOnSound');
    if (neonSound) {
      neonSound.currentTime = 0;
      neonSound.volume = 0.5;
      neonSound.play().catch(e => console.log("Sound play failed:", e));
    }

    // 2. –ü–†–û–°–¢–û –ü–û–ö–ê–ó–´–í–ê–ï–ú –¢–ï–ö–°–¢ (–∞–Ω–∏–º–∞—Ü–∏—è —É–∂–µ –≤ CSS)
    compText.style.opacity = 1;
    compText.style.transition = 'opacity 1s ease';

    // 3. –ü–û–ö–ê–ó–´–í–ê–ï–ú –ö–ù–û–ü–ö–£
    nextBtn.style.opacity = '1';
    nextBtn.style.transition = 'opacity 0.5s ease';

    setTimeout(()=>{
      nextBtn.disabled = false;
    }, 500);
  }, delay);
}

/* ===== –£–ë–ï–ì–ê–Æ–©–ê–Ø –ö–ù–û–ü–ö–ê "–ù–ï–¢" ===== */
const noBtn = document.getElementById('noBtn');
let noBtnInitialized = false;

function initNoButtonPosition() {
  if (noBtnInitialized) return;

  const noBtnArea = document.createElement('div');
  noBtnArea.className = 'no-btn-area';
  noBtnArea.style.position = 'relative';
  noBtnArea.style.width = '100%';
  noBtnArea.style.height = '200px';
  noBtnArea.style.marginTop = '0';
  noBtnArea.style.borderRadius = '15px';
  noBtnArea.style.overflow = 'hidden';

  const buttonsContainer = document.querySelector('#screen5 .buttons-container');
  buttonsContainer.removeChild(noBtn);
  noBtnArea.appendChild(noBtn);
  buttonsContainer.appendChild(noBtnArea);

  noBtn.style.position = 'absolute';
  noBtn.style.left = '0px';
  noBtn.style.top = '0px';
  noBtn.style.margin = '0';
  noBtn.style.transition = 'none';

  const btnRect = noBtn.getBoundingClientRect();
  const areaRect = noBtnArea.getBoundingClientRect();

  const startX = (areaRect.width - btnRect.width) / 2;
  const startY = 10;
  noBtn.style.left = `${startX}px`;
  noBtn.style.top = `${startY}px`;

  requestAnimationFrame(() => {
    noBtn.style.transition = 'all 0.3s ease';
  });

  noBtnInitialized = true;
}

function getRandomPosition(btnRect, areaRect) {
  const buttonDiagonal = Math.hypot(btnRect.width, btnRect.height);
  const minDistance = buttonDiagonal + 20;

  const minX = 10;
  const maxX = areaRect.width - btnRect.width - 10;
  const minY = 10;
  const maxY = areaRect.height - btnRect.height - 10;

  let newX, newY;
  let attempts = 0;
  const lastX = parseFloat(noBtn.style.left) || areaRect.width/2;
  const lastY = parseFloat(noBtn.style.top) || areaRect.height/2;

  do {
    newX = minX + Math.random() * (maxX - minX);
    newY = minY + Math.random() * (maxY - minY);
    attempts++;
    if (attempts > 5) break;
  } while (Math.hypot(newX - lastX, newY - lastY) < minDistance && attempts < 50);

  return { x: newX, y: newY };
}

function moveNoButton() {
  const noBtnArea = document.querySelector('#screen5 .no-btn-area');
  const btnRect = noBtn.getBoundingClientRect();
  const areaRect = noBtnArea.getBoundingClientRect();

  const newPos = getRandomPosition(btnRect, areaRect);

  noBtn.style.transition = 'all 0.15s ease';
  noBtn.style.left = newPos.x + 'px';
  noBtn.style.top = newPos.y + 'px';

  setTimeout(() => {
    noBtn.style.transition = 'all 0.3s ease';
  }, 150);
}

noBtn.addEventListener('mouseenter', moveNoButton);
noBtn.addEventListener('touchstart', function(e) {
  e.preventDefault();
  moveNoButton();
});

noBtn.addEventListener('click', function(e) {
  e.preventDefault();
  e.stopPropagation();
  moveNoButton();
});

/* ===== –ê–ù–ò–ú–ê–¶–ò–Ø –†–ê–ó–õ–ï–¢–ê–Æ–©–ò–•–°–Ø –°–ï–†–î–ï–ß–ï–ö ===== */
// –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ emoji
function createHeartExplosion(event) {
  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å–µ—Ä–¥–µ—á–µ–∫ (ü•∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –±—É–¥–µ—Ç)
  const hearts = ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú'];

  // –í–∏–±—Ä–∞—Ü–∏—è
  navigator.vibrate?.([100, 50, 100, 50, 100]);

  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞
  let clickX, clickY;
  if (event.type === 'touchstart') {
    clickX = event.touches[0].clientX;
    clickY = event.touches[0].clientY;
    event.preventDefault();
  } else {
    clickX = event.clientX;
    clickY = event.clientY;
  }

  // 30 –æ–±—ã—á–Ω—ã—Ö —Å–µ—Ä–¥–µ—á–µ–∫
  for (let i = 0; i < 30; i++) {
    const heart = document.createElement('div');
    heart.className = 'heart-particle';

    heart.innerText = hearts[Math.floor(Math.random() * hearts.length)];
    heart.style.left = clickX + 'px';
    heart.style.top = clickY + 'px';

    const angle = Math.random() * Math.PI * 2;
    const velocity = 120 + Math.random() * 180;
    const tx = Math.cos(angle) * velocity;
    const ty = Math.sin(angle) * velocity;

    const rotate1 = Math.random() * 360 + 'deg';
    const rotate2 = Math.random() * 720 + 'deg';
    const rotate3 = Math.random() * 1080 + 'deg';

    heart.style.setProperty('--tx', tx + 'px');
    heart.style.setProperty('--ty', ty + 'px');
    heart.style.setProperty('--rotate', rotate1);
    heart.style.setProperty('--rotate2', rotate2);
    heart.style.setProperty('--rotate3', rotate3);

    heart.style.fontSize = (18 + Math.random() * 20) + 'px';
    heart.style.animationDelay = (Math.random() * 0.2) + 's';

    document.body.appendChild(heart);

    setTimeout(() => {
      if (heart.parentNode) heart.remove();
    }, 3000);
  }

  // –û–î–ù–ê ü•∞ ‚Äî –∫—Ä—É–ø–Ω–µ–µ –∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –ù–û –ù–ï –Ø–†–ß–ï
  const specialHeart = document.createElement('div');
  specialHeart.className = 'heart-particle';
  specialHeart.innerText = 'ü•∞';
  specialHeart.style.left = clickX + 'px';
  specialHeart.style.top = clickY + 'px';
  specialHeart.style.fontSize = '35px'; // –¢–æ–ª—å–∫–æ –∫—Ä—É–ø–Ω–µ–µ
  specialHeart.style.zIndex = '1001';

  // –°–ª—É—á–∞–π–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Äî –ö–ê–ö –£ –í–°–ï–•!
  const angle = Math.random() * Math.PI * 2;
  const velocity = 60 + Math.random() * 80; // –ú–ï–î–õ–ï–ù–ù–ï–ï
  const tx = Math.cos(angle) * velocity;
  const ty = Math.sin(angle) * velocity;

  const rotate1 = Math.random() * 360 + 'deg';
  const rotate2 = Math.random() * 720 + 'deg';
  const rotate3 = Math.random() * 1080 + 'deg';

  specialHeart.style.setProperty('--tx', tx + 'px');
  specialHeart.style.setProperty('--ty', ty + 'px');
  specialHeart.style.setProperty('--rotate', rotate1);
  specialHeart.style.setProperty('--rotate2', rotate2);
  specialHeart.style.setProperty('--rotate3', rotate3);

  // –ë–ï–ó –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è! –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π filter –∏–∑ CSS
  specialHeart.style.animation = 'heartExplode 4s ease-out forwards';
  specialHeart.style.animationDelay = (Math.random() * 0.1) + 's';

  document.body.appendChild(specialHeart);

  setTimeout(() => {
    if (specialHeart.parentNode) specialHeart.remove();
  }, 4000);
}

// –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
const hugBtn = document.getElementById('hugBtn');
hugBtn.removeEventListener('click', createHeartExplosion);
hugBtn.addEventListener('click', createHeartExplosion);
hugBtn.addEventListener('touchstart', function(e) {
  e.preventDefault();
  createHeartExplosion(e);
});
</script>

</body>
</html>
